(()=>{"use strict";var e=(()=>(function(e){e[e.PERMUTATION_ID_LOBYTE=0]="PERMUTATION_ID_LOBYTE",e[e.PERMUTATION_ID_HIBYTE=1]="PERMUTATION_ID_HIBYTE",e[e.USED_MOD1=2]="USED_MOD1",e[e.USED_MOD2=3]="USED_MOD2",e[e.USED_MOD3=4]="USED_MOD3",e[e.USED_MOD4=5]="USED_MOD4",e[e.USED_MOD5=6]="USED_MOD5",e[e.WIDTH=7]="WIDTH"}(e||(e={})),e))(),t=(()=>(function(e){e[e.PowerfulFriends=0]="PowerfulFriends",e[e.RadiantLight=1]="RadiantLight",e[e.ProtectiveLight=100]="ProtectiveLight",e[e.ExtraReserves=101]="ExtraReserves",e[e.PrecicelyCharged=102]="PrecicelyCharged",e[e.StacksOnStacks=103]="StacksOnStacks",e[e.PrecisionCharge=104]="PrecisionCharge",e[e.SurpriseAttack=105]="SurpriseAttack",e[e.EnergyConverter=106]="EnergyConverter",e[e.ChargeHarvester=107]="ChargeHarvester",e[e.WhisperOfDurance=1e3]="WhisperOfDurance",e[e.WhisperOfChains=1001]="WhisperOfChains",e[e.WhisperOfConduction=1002]="WhisperOfConduction",e[e.WhisperOfShards=1003]="WhisperOfShards",e[e.WhisperOfHedrons=1100]="WhisperOfHedrons",e[e.WhisperOfBonds=1101]="WhisperOfBonds",e[e.WhisperOfHunger=1102]="WhisperOfHunger",e[e.WhisperOfFractures=1103]="WhisperOfFractures"}(t||(t={})),t))(),i=(()=>(function(e){e[e.CombatStyleMod=0]="CombatStyleMod",e[e.Stasis=1]="Stasis"}(i||(i={})),i))(),s=(()=>(function(e){e[e.NONE=0]="NONE",e[e.MINOR_MOBILITY=1]="MINOR_MOBILITY",e[e.MAJOR_MOBILITY=2]="MAJOR_MOBILITY",e[e.MINOR_RESILIENCE=3]="MINOR_RESILIENCE",e[e.MAJOR_RESILIENCE=4]="MAJOR_RESILIENCE",e[e.MINOR_RECOVERY=5]="MINOR_RECOVERY",e[e.MAJOR_RECOVERY=6]="MAJOR_RECOVERY",e[e.MINOR_DISCIPLINE=7]="MINOR_DISCIPLINE",e[e.MAJOR_DISCIPLINE=8]="MAJOR_DISCIPLINE",e[e.MINOR_INTELLECT=9]="MINOR_INTELLECT",e[e.MAJOR_INTELLECT=10]="MAJOR_INTELLECT",e[e.MINOR_STRENGTH=11]="MINOR_STRENGTH",e[e.MAJOR_STRENGTH=12]="MAJOR_STRENGTH"}(s||(s={})),s))(),r=(()=>(function(e){e[e.Mobility=0]="Mobility",e[e.Resilience=1]="Resilience",e[e.Recovery=2]="Recovery",e[e.Discipline=3]="Discipline",e[e.Intellect=4]="Intellect",e[e.Strength=5]="Strength"}(r||(r={})),r))(),a=(()=>(function(e){e[e.ClassAbilityRegenerationStat=10]="ClassAbilityRegenerationStat"}(a||(a={})),a))();const n={[t.PowerfulFriends]:{id:t.PowerfulFriends,name:"Powerful Friends",type:i.CombatStyleMod,bonus:[{stat:r.Mobility,value:20}]},[t.RadiantLight]:{id:t.RadiantLight,name:"Radiant Light",type:i.CombatStyleMod,bonus:[{stat:r.Strength,value:20}]},[t.ProtectiveLight]:{id:t.ProtectiveLight,name:"Protective Light",type:i.CombatStyleMod,bonus:[{stat:r.Strength,value:-10}]},[t.ExtraReserves]:{id:t.ExtraReserves,name:"Extra Reserves",type:i.CombatStyleMod,bonus:[{stat:r.Intellect,value:-10}]},[t.PrecicelyCharged]:{id:t.PrecicelyCharged,name:"Precicely Charged",type:i.CombatStyleMod,bonus:[{stat:r.Discipline,value:-10}]},[t.StacksOnStacks]:{id:t.StacksOnStacks,name:"Stacks on Stacks",type:i.CombatStyleMod,bonus:[{stat:r.Discipline,value:-10}]},[t.PrecisionCharge]:{id:t.PrecisionCharge,name:"Precision Charge",type:i.CombatStyleMod,bonus:[{stat:r.Strength,value:-10}]},[t.SurpriseAttack]:{id:t.SurpriseAttack,name:"Surprise Attack",type:i.CombatStyleMod,bonus:[{stat:r.Intellect,value:-10}]},[t.EnergyConverter]:{id:t.EnergyConverter,name:"Energy Converter",type:i.CombatStyleMod,bonus:[{stat:r.Discipline,value:-10}]},[t.ChargeHarvester]:{id:t.ChargeHarvester,name:"Charge Harvester",type:i.CombatStyleMod,bonus:[{stat:a.ClassAbilityRegenerationStat,value:-10}]},[t.WhisperOfDurance]:{id:t.WhisperOfDurance,name:"Whisper Of Durance",type:i.Stasis,bonus:[{stat:r.Strength,value:10}]},[t.WhisperOfChains]:{id:t.WhisperOfChains,name:"Whisper Of Chains",type:i.Stasis,bonus:[{stat:r.Recovery,value:10}]},[t.WhisperOfShards]:{id:t.WhisperOfShards,name:"Whisper Of Shards",type:i.Stasis,bonus:[{stat:r.Resilience,value:10}]},[t.WhisperOfConduction]:{id:t.WhisperOfConduction,name:"Whisper Of Conduction",type:i.Stasis,bonus:[{stat:r.Resilience,value:10},{stat:r.Intellect,value:10}]},[t.WhisperOfBonds]:{id:t.WhisperOfBonds,name:"Whisper of Bonds",type:i.Stasis,bonus:[{stat:r.Discipline,value:-10},{stat:r.Intellect,value:-10}]},[t.WhisperOfHedrons]:{id:t.WhisperOfHedrons,name:"Whisper of Hedrons",type:i.Stasis,bonus:[{stat:r.Strength,value:-10}]},[t.WhisperOfFractures]:{id:t.WhisperOfFractures,name:"Whisper of Fractures",type:i.Stasis,bonus:[{stat:r.Discipline,value:-10}]},[t.WhisperOfHunger]:{id:t.WhisperOfHunger,name:"Whisper of Hunger",type:i.Stasis,bonus:[{stat:r.Mobility,value:-10},{stat:r.Recovery,value:-10}]}};addEventListener("message",({data:t})=>{const i=new Uint32Array(t.permutations),o=t.startPosition,l=t.config;console.time(`WebWorker: Results Builder Helper ${o}`);let O=l.characterClass,h=[0,0,0,0,0,0],c=new Set,u=new Set,f=[];for(let e=0;e<i.length;e+=12){const t=i.subarray(e,e+12);if(l.selectedExoticHash>0&&t[10]!=l.selectedExoticHash)continue;if(-1==l.selectedExoticHash&&0!=t[10])continue;if(l.onlyUseMasterworkedItems&&15!=t[11])continue;let d=[t[4]+2,t[5]+2,t[6]+2,t[7]+2,t[8]+2,t[9]+2];if(l.assumeMasterworked)for(let e=0;e<6;e++)d[e]+=8;else for(let e=0;e<4;e++)if((t[11]&1<<e)>0)for(let t=0;t<6;t++)d[t]+=2;for(const e of l.enabledMods)for(const t of n[e].bonus)switch(t.stat){case a.ClassAbilityRegenerationStat:d[[1,0,3][O]]+=t.value;break;default:d[t.stat]+=t.value}let I=d.map((e,t)=>Math.max(0,10*l.minimumStatTier[t]-e)).reduce((e,t,i)=>{if(0==t)return e;let s=t%10>0&&t%10<=5?1:0,r=Math.ceil(Math.max(0,t-5*s)/10);s&&e.push(1+2*i);for(let a=0;a<r;a++)e.push(2*i+1+1);return e},[]);if(I.length>l.maximumStatMods)continue;if(l.tryLimitWastedStats){let e=[d[r.Mobility]+(I.indexOf(s.MINOR_MOBILITY)>-1?5:0),d[r.Resilience]+(I.indexOf(s.MINOR_RESILIENCE)>-1?5:0),d[r.Recovery]+(I.indexOf(s.MINOR_RECOVERY)>-1?5:0),d[r.Discipline]+(I.indexOf(s.MINOR_DISCIPLINE)>-1?5:0),d[r.Intellect]+(I.indexOf(s.MINOR_INTELLECT)>-1?5:0),d[r.Strength]+(I.indexOf(s.MINOR_STRENGTH)>-1?5:0)].map((e,t)=>[e%10,t,e]).sort((e,t)=>t[0]-e[0]);if(I.length<l.maximumStatMods)for(let t=I.length;t<l.maximumStatMods;t++){let t=e.filter(e=>e[2]<100).filter(e=>5==e[0])[0];if(!t)break;t[0]-=5,I.push(1+2*t[1])}if(l.onlyShowResultsWithNoWastedStats&&e.reduce((e,t)=>e+t[0],0)>0)continue}for(let e=0;e<6;e++){let t=Math.min(10,Math.floor(d[e]/10)+(l.maximumStatMods-I.length)+I.filter(t=>Math.floor((t-1)/2)==e).length);h[e]<t&&(h[e]=t)}let S=l.maximumStatMods-I.length;if(S>=0){let e=d.map((e,t)=>e+10*I.filter(e=>Math.floor((e-1)/2)==t).length).map((e,t)=>[Math.max(0,Math.ceil((100-e)/10)),t]).sort((e,t)=>e[0]-t[0]);for(let r in e)for(;S>0&&e[r][0]>0;)S--,e[r][0]--;const t=e.filter(e=>0==e[0]);let i=t.length,s=t.reduce((e,t)=>e+(1<<t[1]),0);3==i&&c.add(s),4==i&&u.add(s)}if(l.tryLimitWastedStats&&I.length<l.maximumStatMods){let e=[d[r.Mobility]+(I.indexOf(s.MINOR_MOBILITY)>-1?5:0),d[r.Resilience]+(I.indexOf(s.MINOR_RESILIENCE)>-1?5:0),d[r.Recovery]+(I.indexOf(s.MINOR_RECOVERY)>-1?5:0),d[r.Discipline]+(I.indexOf(s.MINOR_DISCIPLINE)>-1?5:0),d[r.Intellect]+(I.indexOf(s.MINOR_INTELLECT)>-1?5:0),d[r.Strength]+(I.indexOf(s.MINOR_STRENGTH)>-1?5:0)].map((e,t)=>[e%10,t,e]).sort((e,t)=>t[0]-e[0]);for(let t=I.length;t<l.maximumStatMods;t++){let t=e.filter(e=>e[2]<100).filter(e=>e[0]>5).sort((e,t)=>e[0]-t[0])[0];if(!t)break;t[0]-=5,I.push(1+2*t[1])}}f.push([o+e/12,...I])}const d=new ArrayBuffer(e.WIDTH*f.length*2),I=new Uint16Array(d);for(let s=0;s<f.length;s++){I[s*e.WIDTH+e.PERMUTATION_ID_LOBYTE]=65535&f[s][0],I[s*e.WIDTH+e.PERMUTATION_ID_HIBYTE]=(-65536&f[s][0])>>16;for(let t=0;t<6;t++)I[s*e.WIDTH+e.USED_MOD1+t]=f[s][t+1]}console.timeEnd(`WebWorker: Results Builder Helper ${o}`),postMessage({buffer:d,maximumPossibleTiers:h,statCombo3x100:c,statCombo4x100:u},[d])})})();