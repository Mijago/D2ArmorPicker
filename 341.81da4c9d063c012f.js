(()=>{"use strict";function wn(e,t,n,r,s,i,o){try{var a=e[i](o),l=a.value}catch(c){return void n(c)}a.done?t(l):Promise.resolve(l).then(r,s)}function ot(e){return function(){var t=this,n=arguments;return new Promise(function(r,s){var i=e.apply(t,n);function o(l){wn(i,r,s,o,a,"next",l)}function a(l){wn(i,r,s,o,a,"throw",l)}o(void 0)})}}const U=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,z=Object.keys,X=Array.isArray;function ee(e,t){return"object"!=typeof t||z(t).forEach(function(n){e[n]=t[n]}),e}typeof Promise<"u"&&!U.Promise&&(U.Promise=Promise);const qe=Object.getPrototypeOf,dr={}.hasOwnProperty;function se(e,t){return dr.call(e,t)}function De(e,t){"function"==typeof t&&(t=t(qe(e))),(typeof Reflect>"u"?z:Reflect.ownKeys)(t).forEach(n=>{ce(e,n,t[n])})}const _n=Object.defineProperty;function ce(e,t,n,r){_n(e,t,ee(n&&se(n,"get")&&"function"==typeof n.get?{get:n.get,set:n.set,configurable:!0}:{value:n,configurable:!0,writable:!0},r))}function Pe(e){return{from:function(t){return e.prototype=Object.create(t.prototype),ce(e.prototype,"constructor",e),{extend:De.bind(null,e.prototype)}}}}const mr=Object.getOwnPropertyDescriptor;function Tt(e,t){let r;return mr(e,t)||(r=qe(e))&&Tt(r,t)}const pr=[].slice;function at(e,t,n){return pr.call(e,t,n)}function Sn(e,t){return t(e)}function je(e){if(!e)throw new Error("Assertion Failed")}function En(e){U.setImmediate?setImmediate(e):setTimeout(e,0)}function xn(e,t){return e.reduce((n,r,s)=>{var i=t(r,s);return i&&(n[i[0]]=i[1]),n},{})}function ue(e,t){if(se(e,t))return e[t];if(!t)return e;if("string"!=typeof t){for(var n=[],r=0,s=t.length;r<s;++r){var i=ue(e,t[r]);n.push(i)}return n}var o=t.indexOf(".");if(-1!==o){var a=e[t.substr(0,o)];return void 0===a?void 0:ue(a,t.substr(o+1))}}function ie(e,t,n){if(e&&void 0!==t&&(!("isFrozen"in Object)||!Object.isFrozen(e)))if("string"!=typeof t&&"length"in t){je("string"!=typeof n&&"length"in n);for(var r=0,s=t.length;r<s;++r)ie(e,t[r],n[r])}else{var i=t.indexOf(".");if(-1!==i){var o=t.substr(0,i),a=t.substr(i+1);if(""===a)void 0===n?X(e)&&!isNaN(parseInt(o))?e.splice(o,1):delete e[o]:e[o]=n;else{var l=e[o];l||(l=e[o]={}),ie(l,a,n)}}else void 0===n?X(e)&&!isNaN(parseInt(t))?e.splice(t,1):delete e[t]:e[t]=n}}function An(e){var t={};for(var n in e)se(e,n)&&(t[n]=e[n]);return t}const vr=[].concat;function Cn(e){return vr.apply([],e)}const kn="Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(Cn([8,16,32,64].map(e=>["Int","Uint","Float"].map(t=>t+e+"Array")))).filter(e=>U[e]),br=kn.map(e=>U[e]);xn(kn,e=>[e,!0]);let ye=null;function He(e){ye=typeof WeakMap<"u"&&new WeakMap;const t=Dt(e);return ye=null,t}function Dt(e){if(!e||"object"!=typeof e)return e;let t=ye&&ye.get(e);if(t)return t;if(X(e)){t=[],ye&&ye.set(e,t);for(var n=0,r=e.length;n<r;++n)t.push(Dt(e[n]))}else if(br.indexOf(e.constructor)>=0)t=e;else{const i=qe(e);for(var s in t=i===Object.prototype?{}:Object.create(i),ye&&ye.set(e,t),e)se(e,s)&&(t[s]=Dt(e[s]))}return t}const{toString:wr}={};function Pt(e){return wr.call(e).slice(8,-1)}const Nt=typeof Symbol<"u"?Symbol.iterator:"@@iterator",_r="symbol"==typeof Nt?function(e){var t;return null!=e&&(t=e[Nt])&&t.apply(e)}:function(){return null},Ne={};function fe(e){var t,n,r,s;if(1===arguments.length){if(X(e))return e.slice();if(this===Ne&&"string"==typeof e)return[e];if(s=_r(e)){for(n=[];!(r=s.next()).done;)n.push(r.value);return n}if(null==e)return[e];if("number"==typeof(t=e.length)){for(n=new Array(t);t--;)n[t]=e[t];return n}return[e]}for(t=arguments.length,n=new Array(t);t--;)n[t]=arguments[t];return n}const Kt=typeof Symbol<"u"?e=>"AsyncFunction"===e[Symbol.toStringTag]:()=>!1;var ae=typeof location<"u"&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function In(e,t){ae=e,On=t}var On=()=>!0;const Sr=!new Error("").stack;function Se(){if(Sr)try{throw new Error}catch(e){return e}return new Error}function Mt(e,t){var n=e.stack;return n?(t=t||0,0===n.indexOf(e.name)&&(t+=(e.name+e.message).split("\n").length),n.split("\n").slice(t).filter(On).map(r=>"\n"+r).join("")):""}var Rn=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],Bt=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"].concat(Rn),xr={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function Ke(e,t){this._e=Se(),this.name=e,this.message=t}function Tn(e,t){return e+". Errors: "+Object.keys(t).map(n=>t[n].toString()).filter((n,r,s)=>s.indexOf(n)===r).join("\n")}function lt(e,t,n,r){this._e=Se(),this.failures=t,this.failedKeys=r,this.successCount=n,this.message=Tn(e,t)}function Ue(e,t){this._e=Se(),this.name="BulkError",this.failures=Object.keys(t).map(n=>t[n]),this.failuresByPos=t,this.message=Tn(e,t)}Pe(Ke).from(Error).extend({stack:{get:function(){return this._stack||(this._stack=this.name+": "+this.message+Mt(this._e,2))}},toString:function(){return this.name+": "+this.message}}),Pe(lt).from(Ke),Pe(Ue).from(Ke);var Ar=Bt.reduce((e,t)=>(e[t]=t+"Error",e),{});const Cr=Ke;var B=Bt.reduce((e,t)=>{var n=t+"Error";function r(s,i){this._e=Se(),this.name=n,s?"string"==typeof s?(this.message=`${s}${i?"\n "+i:""}`,this.inner=i||null):"object"==typeof s&&(this.message=`${s.name} ${s.message}`,this.inner=s):(this.message=xr[t]||n,this.inner=null)}return Pe(r).from(Cr),e[t]=r,e},{});B.Syntax=SyntaxError,B.Type=TypeError,B.Range=RangeError;var Dn=Rn.reduce((e,t)=>(e[t+"Error"]=B[t],e),{}),ct=Bt.reduce((e,t)=>(-1===["Syntax","Type","Range"].indexOf(t)&&(e[t+"Error"]=B[t]),e),{});function H(){}function Ge(e){return e}function Ir(e,t){return null==e||e===Ge?t:function(n){return t(e(n))}}function Ee(e,t){return function(){e.apply(this,arguments),t.apply(this,arguments)}}function Or(e,t){return e===H?t:function(){var n=e.apply(this,arguments);void 0!==n&&(arguments[0]=n);var r=this.onsuccess,s=this.onerror;this.onsuccess=null,this.onerror=null;var i=t.apply(this,arguments);return r&&(this.onsuccess=this.onsuccess?Ee(r,this.onsuccess):r),s&&(this.onerror=this.onerror?Ee(s,this.onerror):s),void 0!==i?i:n}}function Rr(e,t){return e===H?t:function(){e.apply(this,arguments);var n=this.onsuccess,r=this.onerror;this.onsuccess=this.onerror=null,t.apply(this,arguments),n&&(this.onsuccess=this.onsuccess?Ee(n,this.onsuccess):n),r&&(this.onerror=this.onerror?Ee(r,this.onerror):r)}}function Tr(e,t){return e===H?t:function(n){var r=e.apply(this,arguments);ee(n,r);var s=this.onsuccess,i=this.onerror;this.onsuccess=null,this.onerror=null;var o=t.apply(this,arguments);return s&&(this.onsuccess=this.onsuccess?Ee(s,this.onsuccess):s),i&&(this.onerror=this.onerror?Ee(i,this.onerror):i),void 0===r?void 0===o?void 0:o:ee(r,o)}}function Dr(e,t){return e===H?t:function(){return!1!==t.apply(this,arguments)&&e.apply(this,arguments)}}function Lt(e,t){return e===H?t:function(){var n=e.apply(this,arguments);if(n&&"function"==typeof n.then){for(var r=this,s=arguments.length,i=new Array(s);s--;)i[s]=arguments[s];return n.then(function(){return t.apply(r,i)})}return t.apply(this,arguments)}}ct.ModifyError=lt,ct.DexieError=Ke,ct.BulkError=Ue;var Ye={};const[Ft,ut,Wt]=typeof Promise>"u"?[]:(()=>{let e=Promise.resolve();if(typeof crypto>"u"||!crypto.subtle)return[e,qe(e),e];const t=crypto.subtle.digest("SHA-512",new Uint8Array([0]));return[t,qe(t),e]})(),Nn=ut&&ut.then,ft=Ft&&Ft.constructor,Vt=!!Wt;var qt=!1,Kr=Wt?()=>{Wt.then(pt)}:U.setImmediate?setImmediate.bind(null,pt):U.MutationObserver?()=>{var e=document.createElement("div");new MutationObserver(()=>{pt(),e=null}).observe(e,{attributes:!0}),e.setAttribute("i","1")}:()=>{setTimeout(pt,0)},ze=function(e,t){$e.push([e,t]),ht&&(Kr(),ht=!1)},jt=!0,ht=!0,xe=[],dt=[],Ht=null,Ut=Ge,Me={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:Hn,pgp:!1,env:{},finalize:function(){this.unhandleds.forEach(e=>{try{Hn(e[0],e[1])}catch{}})}},N=Me,$e=[],Ae=0,mt=[];function T(e){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");this._listeners=[],this.onuncatched=H,this._lib=!1;var t=this._PSD=N;if(ae&&(this._stackHolder=Se(),this._prev=null,this._numPrev=0),"function"!=typeof e){if(e!==Ye)throw new TypeError("Not a function");return this._state=arguments[1],this._value=arguments[2],void(!1===this._state&&Yt(this,this._value))}this._state=null,this._value=null,++t.ref,Mn(this,e)}const Gt={get:function(){var e=N,t=vt;function n(r,s){var i=!e.global&&(e!==N||t!==vt);const o=i&&!he();var a=new T((l,c)=>{zt(this,new Kn(wt(r,e,i,o),wt(s,e,i,o),l,c,e))});return ae&&Fn(a,this),a}return n.prototype=Ye,n},set:function(e){ce(this,"then",e&&e.prototype===Ye?Gt:{get:function(){return e},set:Gt.set})}};function Kn(e,t,n,r,s){this.onFulfilled="function"==typeof e?e:null,this.onRejected="function"==typeof t?t:null,this.resolve=n,this.reject=r,this.psd=s}function Mn(e,t){try{t(n=>{if(null===e._state){if(n===e)throw new TypeError("A promise cannot be resolved with itself.");var r=e._lib&&Je();n&&"function"==typeof n.then?Mn(e,(s,i)=>{n instanceof T?n._then(s,i):n.then(s,i)}):(e._state=!0,e._value=n,Bn(e)),r&&Xe()}},Yt.bind(null,e))}catch(n){Yt(e,n)}}function Yt(e,t){if(dt.push(t),null===e._state){var n=e._lib&&Je();t=Ut(t),e._state=!1,e._value=t,ae&&null!==t&&"object"==typeof t&&!t._promise&&function yr(e,t,n){try{e.apply(null,n)}catch(r){t&&t(r)}}(()=>{var r=Tt(t,"stack");t._promise=e,ce(t,"stack",{get:()=>qt?r&&(r.get?r.get.apply(t):r.value):e.stack})}),function Lr(e){xe.some(t=>t._value===e._value)||xe.push(e)}(e),Bn(e),n&&Xe()}}function Bn(e){var t=e._listeners;e._listeners=[];for(var n=0,r=t.length;n<r;++n)zt(e,t[n]);var s=e._PSD;--s.ref||s.finalize(),0===Ae&&(++Ae,ze(()=>{0==--Ae&&$t()},[]))}function zt(e,t){if(null!==e._state){var n=e._state?t.onFulfilled:t.onRejected;if(null===n)return(e._state?t.resolve:t.reject)(e._value);++t.psd.ref,++Ae,ze(Mr,[n,e,t])}else e._listeners.push(t)}function Mr(e,t,n){try{Ht=t;var r,s=t._value;t._state?r=e(s):(dt.length&&(dt=[]),r=e(s),-1===dt.indexOf(s)&&function Fr(e){for(var t=xe.length;t;)if(xe[--t]._value===e._value)return void xe.splice(t,1)}(t)),n.resolve(r)}catch(i){n.reject(i)}finally{Ht=null,0==--Ae&&$t(),--n.psd.ref||n.psd.finalize()}}function Ln(e,t,n){if(t.length===n)return t;var r="";if(!1===e._state){var i,o,s=e._value;null!=s?(i=s.name||"Error",o=s.message||s,r=Mt(s,0)):(i=s,o=""),t.push(i+(o?": "+o:"")+r)}return ae&&((r=Mt(e._stackHolder,2))&&-1===t.indexOf(r)&&t.push(r),e._prev&&Ln(e._prev,t,n)),t}function Fn(e,t){var n=t?t._numPrev+1:0;n<100&&(e._prev=t,e._numPrev=n)}function pt(){Je()&&Xe()}function Je(){var e=jt;return jt=!1,ht=!1,e}function Xe(){var e,t,n;do{for(;$e.length>0;)for(e=$e,$e=[],n=e.length,t=0;t<n;++t){var r=e[t];r[0].apply(null,r[1])}}while($e.length>0);jt=!0,ht=!0}function $t(){var e=xe;xe=[],e.forEach(r=>{r._PSD.onunhandled.call(null,r._value,r)});for(var t=mt.slice(0),n=t.length;n;)t[--n]()}function yt(e){return new T(Ye,!1,e)}function G(e,t){var n=N;return function(){var r=Je(),s=N;try{return ve(n,!0),e.apply(this,arguments)}catch(i){t&&t(i)}finally{ve(s,!1),r&&Xe()}}}De(T.prototype,{then:Gt,_then:function(e,t){zt(this,new Kn(null,null,e,t,N))},catch:function(e){if(1===arguments.length)return this.then(null,e);var t=arguments[0],n=arguments[1];return this.then(null,"function"==typeof t?r=>r instanceof t?n(r):yt(r):r=>r&&r.name===t?n(r):yt(r))},finally:function(e){return this.then(t=>(e(),t),t=>(e(),yt(t)))},stack:{get:function(){if(this._stack)return this._stack;try{qt=!0;var t=Ln(this,[],20).join("\nFrom previous: ");return null!==this._state&&(this._stack=t),t}finally{qt=!1}}},timeout:function(e,t){return e<1/0?new T((n,r)=>{var s=setTimeout(()=>r(new B.Timeout(t)),e);this.then(n,r).finally(clearTimeout.bind(null,s))}):this}}),typeof Symbol<"u"&&Symbol.toStringTag&&ce(T.prototype,Symbol.toStringTag,"Dexie.Promise"),Me.env=Wn(),De(T,{all:function(){var e=fe.apply(null,arguments).map(bt);return new T(function(t,n){0===e.length&&t([]);var r=e.length;e.forEach((s,i)=>T.resolve(s).then(o=>{e[i]=o,--r||t(e)},n))})},resolve:e=>{if(e instanceof T)return e;if(e&&"function"==typeof e.then)return new T((n,r)=>{e.then(n,r)});var t=new T(Ye,!0,e);return Fn(t,Ht),t},reject:yt,race:function(){var e=fe.apply(null,arguments).map(bt);return new T((t,n)=>{e.map(r=>T.resolve(r).then(t,n))})},PSD:{get:()=>N,set:e=>N=e},totalEchoes:{get:()=>vt},newPSD:ge,usePSD:Le,scheduler:{get:()=>ze,set:e=>{ze=e}},rejectionMapper:{get:()=>Ut,set:e=>{Ut=e}},follow:(e,t)=>new T((n,r)=>ge((s,i)=>{var o=N;o.unhandleds=[],o.onunhandled=i,o.finalize=Ee(function(){!function Br(e){mt.push(function t(){e(),mt.splice(mt.indexOf(t),1)}),++Ae,ze(()=>{0==--Ae&&$t()},[])}(()=>{0===this.unhandleds.length?s():i(this.unhandleds[0])})},o.finalize),e()},t,n,r))}),ft&&(ft.allSettled&&ce(T,"allSettled",function(){const e=fe.apply(null,arguments).map(bt);return new T(t=>{0===e.length&&t([]);let n=e.length;const r=new Array(n);e.forEach((s,i)=>T.resolve(s).then(o=>r[i]={status:"fulfilled",value:o},o=>r[i]={status:"rejected",reason:o}).then(()=>--n||t(r)))})}),ft.any&&typeof AggregateError<"u"&&ce(T,"any",function(){const e=fe.apply(null,arguments).map(bt);return new T((t,n)=>{0===e.length&&n(new AggregateError([]));let r=e.length;const s=new Array(r);e.forEach((i,o)=>T.resolve(i).then(a=>t(a),a=>{s[o]=a,--r||n(new AggregateError(s))}))})}));const Q={awaits:0,echoes:0,id:0};var Wr=0,gt=[],Jt=0,vt=0,Vr=0;function ge(e,t,n,r){var s=N,i=Object.create(s);i.parent=s,i.ref=0,i.global=!1,i.id=++Vr;var o=Me.env;i.env=Vt?{Promise:T,PromiseProp:{value:T,configurable:!0,writable:!0},all:T.all,race:T.race,allSettled:T.allSettled,any:T.any,resolve:T.resolve,reject:T.reject,nthen:qn(o.nthen,i),gthen:qn(o.gthen,i)}:{},t&&ee(i,t),++s.ref,i.finalize=function(){--this.parent.ref||this.parent.finalize()};var a=Le(i,e,n,r);return 0===i.ref&&i.finalize(),a}function Be(){return Q.id||(Q.id=++Wr),++Q.awaits,Q.echoes+=100,Q.id}function he(){return!!Q.awaits&&(0==--Q.awaits&&(Q.id=0),Q.echoes=100*Q.awaits,!0)}function bt(e){return Q.echoes&&e&&e.constructor===ft?(Be(),e.then(t=>(he(),t),t=>(he(),$(t)))):e}function qr(e){++vt,(!Q.echoes||0==--Q.echoes)&&(Q.echoes=Q.id=0),gt.push(N),ve(e,!0)}function jr(){var e=gt[gt.length-1];gt.pop(),ve(e,!1)}function ve(e,t){var n=N;if((t?Q.echoes&&(!Jt++||e!==N):Jt&&(!--Jt||e!==N))&&Vn(t?qr.bind(null,e):jr),e!==N&&(N=e,n===Me&&(Me.env=Wn()),Vt)){var r=Me.env.Promise,s=e.env;ut.then=s.nthen,r.prototype.then=s.gthen,(n.global||e.global)&&(Object.defineProperty(U,"Promise",s.PromiseProp),r.all=s.all,r.race=s.race,r.resolve=s.resolve,r.reject=s.reject,s.allSettled&&(r.allSettled=s.allSettled),s.any&&(r.any=s.any))}}function Wn(){var e=U.Promise;return Vt?{Promise:e,PromiseProp:Object.getOwnPropertyDescriptor(U,"Promise"),all:e.all,race:e.race,allSettled:e.allSettled,any:e.any,resolve:e.resolve,reject:e.reject,nthen:ut.then,gthen:e.prototype.then}:{}}function Le(e,t,n,r,s){var i=N;try{return ve(e,!0),t(n,r,s)}finally{ve(i,!1)}}function Vn(e){Nn.call(Ft,e)}function wt(e,t,n,r){return"function"!=typeof e?e:function(){var s=N;n&&Be(),ve(t,!0);try{return e.apply(this,arguments)}finally{ve(s,!1),r&&Vn(he)}}}function qn(e,t){return function(n,r){return e.call(this,wt(n,t),wt(r,t))}}-1===(""+Nn).indexOf("[native code]")&&(Be=he=H);const jn="unhandledrejection";function Hn(e,t){var n;try{n=t.onuncatched(e)}catch{}if(!1!==n)try{var r,s={promise:t,reason:e};if(U.document&&document.createEvent?((r=document.createEvent("Event")).initEvent(jn,!0,!0),ee(r,s)):U.CustomEvent&&ee(r=new CustomEvent(jn,{detail:s}),s),r&&U.dispatchEvent&&(dispatchEvent(r),!U.PromiseRejectionEvent&&U.onunhandledrejection))try{U.onunhandledrejection(r)}catch{}ae&&r&&!r.defaultPrevented&&console.warn(`Unhandled rejection: ${e.stack||e}`)}catch{}}var $=T.reject;function Un(e,t,n,r){if(e.idbdb&&(e._state.openComplete||N.letThrough||e._vip)){var s=e._createTransaction(t,n,e._dbSchema);try{s.create()}catch(i){return $(i)}return s._promise(t,(i,o)=>ge(()=>(N.trans=s,r(i,o,s)))).then(i=>s._completion.then(()=>i))}if(e._state.openComplete)return $(new B.DatabaseClosed(e._state.dbOpenError));if(!e._state.isBeingOpened){if(!e._options.autoOpen)return $(new B.DatabaseClosed);e.open().catch(H)}return e._state.dbReadyPromise.then(()=>Un(e,t,n,r))}const Ce=String.fromCharCode(65535),Xt=-1/0,de="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",Yn="String expected.",Qe=[],_t=typeof navigator<"u"&&/(MSIE|Trident|Edge)/.test(navigator.userAgent),Hr=_t,Ur=_t,zn=e=>!/(dexie\.js|dexie\.min\.js)/.test(e),St="__dbnames",Qt="readonly",Zt="readwrite";function ke(e,t){return e?t?function(){return e.apply(this,arguments)&&t.apply(this,arguments)}:e:t}const $n={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function Et(e){return"string"!=typeof e||/\./.test(e)?t=>t:t=>(void 0===t[e]&&e in t&&delete(t=He(t))[e],t)}class Gr{_trans(t,n,r){const s=this._tx||N.trans,i=this.name;function o(l,c,h){if(!h.schema[i])throw new B.NotFound("Table "+i+" not part of transaction");return n(h.idbtrans,h)}const a=Je();try{return s&&s.db===this.db?s===N.trans?s._promise(t,o,r):ge(()=>s._promise(t,o,r),{trans:s,transless:N.transless||N}):Un(this.db,t,[this.name],o)}finally{a&&Xe()}}get(t,n){return t&&t.constructor===Object?this.where(t).first(n):this._trans("readonly",r=>this.core.get({trans:r,key:t}).then(s=>this.hook.reading.fire(s))).then(n)}where(t){if("string"==typeof t)return new this.db.WhereClause(this,t);if(X(t))return new this.db.WhereClause(this,`[${t.join("+")}]`);const n=z(t);if(1===n.length)return this.where(n[0]).equals(t[n[0]]);const r=this.schema.indexes.concat(this.schema.primKey).filter(c=>c.compound&&n.every(h=>c.keyPath.indexOf(h)>=0)&&c.keyPath.every(h=>n.indexOf(h)>=0))[0];if(r&&this.db._maxKey!==Ce)return this.where(r.name).equals(r.keyPath.map(c=>t[c]));!r&&ae&&console.warn(`The query ${JSON.stringify(t)} on ${this.name} would benefit of a compound index [${n.join("+")}]`);const{idxByName:s}=this.schema,i=this.db._deps.indexedDB;function o(c,h){try{return 0===i.cmp(c,h)}catch{return!1}}const[a,l]=n.reduce(([c,h],u)=>{const f=s[u],d=t[u];return[c||f,c||!f?ke(h,f&&f.multi?E=>{const m=ue(E,u);return X(m)&&m.some(S=>o(d,S))}:E=>o(d,ue(E,u))):h]},[null,null]);return a?this.where(a.name).equals(t[a.keyPath]).filter(l):r?this.filter(l):this.where(n).equals("")}filter(t){return this.toCollection().and(t)}count(t){return this.toCollection().count(t)}offset(t){return this.toCollection().offset(t)}limit(t){return this.toCollection().limit(t)}each(t){return this.toCollection().each(t)}toArray(t){return this.toCollection().toArray(t)}toCollection(){return new this.db.Collection(new this.db.WhereClause(this))}orderBy(t){return new this.db.Collection(new this.db.WhereClause(this,X(t)?`[${t.join("+")}]`:t))}reverse(){return this.toCollection().reverse()}mapToClass(t){this.schema.mappedClass=t;const n=r=>{if(!r)return r;const s=Object.create(t.prototype);for(var i in r)if(se(r,i))try{s[i]=r[i]}catch{}return s};return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=n,this.hook("reading",n),t}defineClass(){return this.mapToClass(function t(n){ee(this,n)})}add(t,n){const{auto:r,keyPath:s}=this.schema.primKey;let i=t;return s&&r&&(i=Et(s)(t)),this._trans("readwrite",o=>this.core.mutate({trans:o,type:"add",keys:null!=n?[n]:null,values:[i]})).then(o=>o.numFailures?T.reject(o.failures[0]):o.lastResult).then(o=>{if(s)try{ie(t,s,o)}catch{}return o})}update(t,n){if("object"!=typeof t||X(t))return this.where(":id").equals(t).modify(n);{const r=ue(t,this.schema.primKey.keyPath);if(void 0===r)return $(new B.InvalidArgument("Given object does not contain its primary key"));try{"function"!=typeof n?z(n).forEach(s=>{ie(t,s,n[s])}):n(t,{value:t,primKey:r})}catch{}return this.where(":id").equals(r).modify(n)}}put(t,n){const{auto:r,keyPath:s}=this.schema.primKey;let i=t;return s&&r&&(i=Et(s)(t)),this._trans("readwrite",o=>this.core.mutate({trans:o,type:"put",values:[i],keys:null!=n?[n]:null})).then(o=>o.numFailures?T.reject(o.failures[0]):o.lastResult).then(o=>{if(s)try{ie(t,s,o)}catch{}return o})}delete(t){return this._trans("readwrite",n=>this.core.mutate({trans:n,type:"delete",keys:[t]})).then(n=>n.numFailures?T.reject(n.failures[0]):void 0)}clear(){return this._trans("readwrite",t=>this.core.mutate({trans:t,type:"deleteRange",range:$n})).then(t=>t.numFailures?T.reject(t.failures[0]):void 0)}bulkGet(t){return this._trans("readonly",n=>this.core.getMany({keys:t,trans:n}).then(r=>r.map(s=>this.hook.reading.fire(s))))}bulkAdd(t,n,r){const s=Array.isArray(n)?n:void 0,i=(r=r||(s?void 0:n))?r.allKeys:void 0;return this._trans("readwrite",o=>{const{auto:a,keyPath:l}=this.schema.primKey;if(l&&s)throw new B.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(s&&s.length!==t.length)throw new B.InvalidArgument("Arguments objects and keys must have the same length");const c=t.length;let h=l&&a?t.map(Et(l)):t;return this.core.mutate({trans:o,type:"add",keys:s,values:h,wantResults:i}).then(({numFailures:u,results:f,lastResult:d,failures:E})=>{if(0===u)return i?f:d;throw new Ue(`${this.name}.bulkAdd(): ${u} of ${c} operations failed`,E)})})}bulkPut(t,n,r){const s=Array.isArray(n)?n:void 0,i=(r=r||(s?void 0:n))?r.allKeys:void 0;return this._trans("readwrite",o=>{const{auto:a,keyPath:l}=this.schema.primKey;if(l&&s)throw new B.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(s&&s.length!==t.length)throw new B.InvalidArgument("Arguments objects and keys must have the same length");const c=t.length;let h=l&&a?t.map(Et(l)):t;return this.core.mutate({trans:o,type:"put",keys:s,values:h,wantResults:i}).then(({numFailures:u,results:f,lastResult:d,failures:E})=>{if(0===u)return i?f:d;throw new Ue(`${this.name}.bulkPut(): ${u} of ${c} operations failed`,E)})})}bulkDelete(t){const n=t.length;return this._trans("readwrite",r=>this.core.mutate({trans:r,type:"delete",keys:t})).then(({numFailures:r,lastResult:s,failures:i})=>{if(0===r)return s;throw new Ue(`${this.name}.bulkDelete(): ${r} of ${n} operations failed`,i)})}}function Ze(e){var t={},n=function(a,l){if(l){for(var c=arguments.length,h=new Array(c-1);--c;)h[c-1]=arguments[c];return t[a].subscribe.apply(null,h),e}if("string"==typeof a)return t[a]};n.addEventType=i;for(var r=1,s=arguments.length;r<s;++r)i(arguments[r]);return n;function i(a,l,c){if("object"==typeof a)return o(a);l||(l=Dr),c||(c=H);var h={subscribers:[],fire:c,subscribe:function(u){-1===h.subscribers.indexOf(u)&&(h.subscribers.push(u),h.fire=l(h.fire,u))},unsubscribe:function(u){h.subscribers=h.subscribers.filter(function(f){return f!==u}),h.fire=h.subscribers.reduce(l,c)}};return t[a]=n[a]=h,h}function o(a){z(a).forEach(function(l){var c=a[l];if(X(c))i(l,a[l][0],a[l][1]);else{if("asap"!==c)throw new B.InvalidArgument("Invalid event config");var h=i(l,Ge,function(){for(var f=arguments.length,d=new Array(f);f--;)d[f]=arguments[f];h.subscribers.forEach(function(E){En(function(){E.apply(null,d)})})})}})}}function et(e,t){return Pe(t).from({prototype:e}),t}function Fe(e,t){return!(e.filter||e.algorithm||e.or)&&(t?e.justLimit:!e.replayFilter)}function en(e,t){e.filter=ke(e.filter,t)}function tn(e,t,n){var r=e.replayFilter;e.replayFilter=r?()=>ke(r(),t()):t,e.justLimit=n&&!r}function xt(e,t){if(e.isPrimKey)return t.primaryKey;const n=t.getIndexByKeyPath(e.index);if(!n)throw new B.Schema("KeyPath "+e.index+" on object store "+t.name+" is not indexed");return n}function Jn(e,t,n){const r=xt(e,t.schema);return t.openCursor({trans:n,values:!e.keysOnly,reverse:"prev"===e.dir,unique:!!e.unique,query:{index:r,range:e.range}})}function At(e,t,n,r){const s=e.replayFilter?ke(e.filter,e.replayFilter()):e.filter;if(e.or){const i={},o=(a,l,c)=>{if(!s||s(l,c,f=>l.stop(f),f=>l.fail(f))){var h=l.primaryKey,u=""+h;"[object ArrayBuffer]"===u&&(u=""+new Uint8Array(h)),se(i,u)||(i[u]=!0,t(a,l,c))}};return Promise.all([e.or._iterate(o,n),Xn(Jn(e,r,n),e.algorithm,o,!e.keysOnly&&e.valueMapper)])}return Xn(Jn(e,r,n),ke(e.algorithm,s),t,!e.keysOnly&&e.valueMapper)}function Xn(e,t,n,r){var i=G(r?(o,a,l)=>n(r(o),a,l):n);return e.then(o=>{if(o)return o.start(()=>{var a=()=>o.continue();(!t||t(o,l=>a=l,l=>{o.stop(l),a=H},l=>{o.fail(l),a=H}))&&i(o.value,o,l=>a=l),a()})})}function te(e,t){try{const n=Qn(e),r=Qn(t);if(n!==r)return"Array"===n?1:"Array"===r?-1:"binary"===n?1:"binary"===r?-1:"string"===n?1:"string"===r?-1:"Date"===n?1:"Date"!==r?NaN:-1;switch(n){case"number":case"Date":case"string":return e>t?1:e<t?-1:0;case"binary":return function Jr(e,t){const n=e.length,r=t.length,s=n<r?n:r;for(let i=0;i<s;++i)if(e[i]!==t[i])return e[i]<t[i]?-1:1;return n===r?0:n<r?-1:1}(Zn(e),Zn(t));case"Array":return function $r(e,t){const n=e.length,r=t.length,s=n<r?n:r;for(let i=0;i<s;++i){const o=te(e[i],t[i]);if(0!==o)return o}return n===r?0:n<r?-1:1}(e,t)}}catch{}return NaN}function Qn(e){const t=typeof e;if("object"!==t)return t;if(ArrayBuffer.isView(e))return"binary";const n=Pt(e);return"ArrayBuffer"===n?"binary":n}function Zn(e){return e instanceof Uint8Array?e:ArrayBuffer.isView(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):new Uint8Array(e)}class Xr{_read(t,n){var r=this._ctx;return r.error?r.table._trans(null,$.bind(null,r.error)):r.table._trans("readonly",t).then(n)}_write(t){var n=this._ctx;return n.error?n.table._trans(null,$.bind(null,n.error)):n.table._trans("readwrite",t,"locked")}_addAlgorithm(t){var n=this._ctx;n.algorithm=ke(n.algorithm,t)}_iterate(t,n){return At(this._ctx,t,n,this._ctx.table.core)}clone(t){var n=Object.create(this.constructor.prototype),r=Object.create(this._ctx);return t&&ee(r,t),n._ctx=r,n}raw(){return this._ctx.valueMapper=null,this}each(t){var n=this._ctx;return this._read(r=>At(n,t,r,n.table.core))}count(t){return this._read(n=>{const r=this._ctx,s=r.table.core;if(Fe(r,!0))return s.count({trans:n,query:{index:xt(r,s.schema),range:r.range}}).then(o=>Math.min(o,r.limit));var i=0;return At(r,()=>(++i,!1),n,s).then(()=>i)}).then(t)}sortBy(t,n){const r=t.split(".").reverse(),s=r[0],i=r.length-1;function o(c,h){return h?o(c[r[h]],h-1):c[s]}var a="next"===this._ctx.dir?1:-1;function l(c,h){var u=o(c,i),f=o(h,i);return u<f?-a:u>f?a:0}return this.toArray(function(c){return c.sort(l)}).then(n)}toArray(t){return this._read(n=>{var r=this._ctx;if("next"===r.dir&&Fe(r,!0)&&r.limit>0){const{valueMapper:s}=r,i=xt(r,r.table.core.schema);return r.table.core.query({trans:n,limit:r.limit,values:!0,query:{index:i,range:r.range}}).then(({result:o})=>s?o.map(s):o)}{const s=[];return At(r,i=>s.push(i),n,r.table.core).then(()=>s)}},t)}offset(t){var n=this._ctx;return t<=0||(n.offset+=t,Fe(n)?tn(n,()=>{var r=t;return(s,i)=>0===r||(1===r?(--r,!1):(i(()=>{s.advance(r),r=0}),!1))}):tn(n,()=>{var r=t;return()=>--r<0})),this}limit(t){return this._ctx.limit=Math.min(this._ctx.limit,t),tn(this._ctx,()=>{var n=t;return function(r,s,i){return--n<=0&&s(i),n>=0}},!0),this}until(t,n){return en(this._ctx,function(r,s,i){return!t(r.value)||(s(i),n)}),this}first(t){return this.limit(1).toArray(function(n){return n[0]}).then(t)}last(t){return this.reverse().first(t)}filter(t){return en(this._ctx,function(n){return t(n.value)}),function zr(e,t){e.isMatch=ke(e.isMatch,t)}(this._ctx,t),this}and(t){return this.filter(t)}or(t){return new this.db.WhereClause(this._ctx.table,t,this)}reverse(){return this._ctx.dir="prev"===this._ctx.dir?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this}desc(){return this.reverse()}eachKey(t){var n=this._ctx;return n.keysOnly=!n.isMatch,this.each(function(r,s){t(s.key,s)})}eachUniqueKey(t){return this._ctx.unique="unique",this.eachKey(t)}eachPrimaryKey(t){var n=this._ctx;return n.keysOnly=!n.isMatch,this.each(function(r,s){t(s.primaryKey,s)})}keys(t){var n=this._ctx;n.keysOnly=!n.isMatch;var r=[];return this.each(function(s,i){r.push(i.key)}).then(function(){return r}).then(t)}primaryKeys(t){var n=this._ctx;if("next"===n.dir&&Fe(n,!0)&&n.limit>0)return this._read(s=>{var i=xt(n,n.table.core.schema);return n.table.core.query({trans:s,values:!1,limit:n.limit,query:{index:i,range:n.range}})}).then(({result:s})=>s).then(t);n.keysOnly=!n.isMatch;var r=[];return this.each(function(s,i){r.push(i.primaryKey)}).then(function(){return r}).then(t)}uniqueKeys(t){return this._ctx.unique="unique",this.keys(t)}firstKey(t){return this.limit(1).keys(function(n){return n[0]}).then(t)}lastKey(t){return this.reverse().firstKey(t)}distinct(){var t=this._ctx,n=t.index&&t.table.schema.idxByName[t.index];if(!n||!n.multi)return this;var r={};return en(this._ctx,function(s){var i=s.primaryKey.toString(),o=se(r,i);return r[i]=!0,!o}),this}modify(t){var n=this._ctx;return this._write(r=>{var s;if("function"==typeof t)s=t;else{var i=z(t),o=i.length;s=function(m){for(var S=!1,y=0;y<o;++y){var k=i[y],x=t[k];ue(m,k)!==x&&(ie(m,k,x),S=!0)}return S}}const a=n.table.core,{outbound:l,extractKey:c}=a.schema.primaryKey,h=this.db._options.modifyChunkSize||200,u=[];let f=0;const d=[],E=(m,S)=>{const{failures:y,numFailures:k}=S;f+=m-k;for(let x of z(y))u.push(y[x])};return this.clone().primaryKeys().then(m=>{const S=y=>{const k=Math.min(h,m.length-y);return a.getMany({trans:r,keys:m.slice(y,y+k),cache:"immutable"}).then(x=>{const w=[],I=[],O=l?[]:null,D=[];for(let p=0;p<k;++p){const C=x[p],R={value:He(C),primKey:m[y+p]};!1!==s.call(R,R.value,R)&&(null==R.value?D.push(m[y+p]):l||0===te(c(C),c(R.value))?(I.push(R.value),l&&O.push(m[y+p])):(D.push(m[y+p]),w.push(R.value)))}const b=Fe(n)&&n.limit===1/0&&("function"!=typeof t||t===nn)&&{index:n.index,range:n.range};return Promise.resolve(w.length>0&&a.mutate({trans:r,type:"add",values:w}).then(p=>{for(let C in p.failures)D.splice(parseInt(C),1);E(w.length,p)})).then(()=>(I.length>0||b&&"object"==typeof t)&&a.mutate({trans:r,type:"put",keys:O,values:I,criteria:b,changeSpec:"function"!=typeof t&&t}).then(p=>E(I.length,p))).then(()=>(D.length>0||b&&t===nn)&&a.mutate({trans:r,type:"delete",keys:D,criteria:b}).then(p=>E(D.length,p))).then(()=>m.length>y+k&&S(y+h))})};return S(0).then(()=>{if(u.length>0)throw new lt("Error modifying one or more objects",u,f,d);return m.length})})})}delete(){var t=this._ctx,n=t.range;return Fe(t)&&(t.isPrimKey&&!Ur||3===n.type)?this._write(r=>{const{primaryKey:s}=t.table.core.schema,i=n;return t.table.core.count({trans:r,query:{index:s,range:i}}).then(o=>t.table.core.mutate({trans:r,type:"deleteRange",range:i}).then(({failures:a,numFailures:h})=>{if(h)throw new lt("Could not delete some values",Object.keys(a).map(u=>a[u]),o-h);return o-h}))}):this.modify(nn)}}const nn=(e,t)=>t.value=null;function Zr(e,t){return e<t?-1:e===t?0:1}function es(e,t){return e>t?-1:e===t?0:1}function re(e,t,n){var r=e instanceof tr?new e.Collection(e):e;return r._ctx.error=n?new n(t):new TypeError(t),r}function We(e){return new e.Collection(e,()=>er("")).limit(0)}function rs(e,t,n,r,s,i){for(var o=Math.min(e.length,r.length),a=-1,l=0;l<o;++l){var c=t[l];if(c!==r[l])return s(e[l],n[l])<0?e.substr(0,l)+n[l]+n.substr(l+1):s(e[l],r[l])<0?e.substr(0,l)+r[l]+n.substr(l+1):a>=0?e.substr(0,a)+t[a]+n.substr(a+1):null;s(e[l],c)<0&&(a=l)}return o<r.length&&"next"===i?e+n.substr(e.length):o<e.length&&"prev"===i?e.substr(0,n.length):a<0?null:e.substr(0,a)+r[a]+n.substr(a+1)}function Ct(e,t,n,r){var s,i,o,a,l,c,h,u=n.length;if(!n.every(m=>"string"==typeof m))return re(e,Yn);function f(m){s=function ts(e){return"next"===e?t=>t.toUpperCase():t=>t.toLowerCase()}(m),i=function ns(e){return"next"===e?t=>t.toLowerCase():t=>t.toUpperCase()}(m),o="next"===m?Zr:es;var S=n.map(function(y){return{lower:i(y),upper:s(y)}}).sort(function(y,k){return o(y.lower,k.lower)});a=S.map(function(y){return y.upper}),l=S.map(function(y){return y.lower}),c=m,h="next"===m?"":r}f("next");var d=new e.Collection(e,()=>be(a[0],l[u-1]+r));d._ondirectionchange=function(m){f(m)};var E=0;return d._addAlgorithm(function(m,S,y){var k=m.key;if("string"!=typeof k)return!1;var x=i(k);if(t(x,l,E))return!0;for(var w=null,I=E;I<u;++I){var O=rs(k,x,a[I],l[I],o,c);null===O&&null===w?E=I+1:(null===w||o(w,O)>0)&&(w=O)}return S(null!==w?function(){m.continue(w+h)}:y),!1}),d}function be(e,t,n,r){return{type:2,lower:e,upper:t,lowerOpen:n,upperOpen:r}}function er(e){return{type:1,lower:e,upper:e}}class tr{get Collection(){return this._ctx.table.db.Collection}between(t,n,r,s){r=!1!==r,s=!0===s;try{return this._cmp(t,n)>0||0===this._cmp(t,n)&&(r||s)&&(!r||!s)?We(this):new this.Collection(this,()=>be(t,n,!r,!s))}catch{return re(this,de)}}equals(t){return null==t?re(this,de):new this.Collection(this,()=>er(t))}above(t){return null==t?re(this,de):new this.Collection(this,()=>be(t,void 0,!0))}aboveOrEqual(t){return null==t?re(this,de):new this.Collection(this,()=>be(t,void 0,!1))}below(t){return null==t?re(this,de):new this.Collection(this,()=>be(void 0,t,!1,!0))}belowOrEqual(t){return null==t?re(this,de):new this.Collection(this,()=>be(void 0,t))}startsWith(t){return"string"!=typeof t?re(this,Yn):this.between(t,t+Ce,!0,!0)}startsWithIgnoreCase(t){return""===t?this.startsWith(t):Ct(this,(n,r)=>0===n.indexOf(r[0]),[t],Ce)}equalsIgnoreCase(t){return Ct(this,(n,r)=>n===r[0],[t],"")}anyOfIgnoreCase(){var t=fe.apply(Ne,arguments);return 0===t.length?We(this):Ct(this,(n,r)=>-1!==r.indexOf(n),t,"")}startsWithAnyOfIgnoreCase(){var t=fe.apply(Ne,arguments);return 0===t.length?We(this):Ct(this,(n,r)=>r.some(s=>0===n.indexOf(s)),t,Ce)}anyOf(){const t=fe.apply(Ne,arguments);let n=this._cmp;try{t.sort(n)}catch{return re(this,de)}if(0===t.length)return We(this);const r=new this.Collection(this,()=>be(t[0],t[t.length-1]));r._ondirectionchange=i=>{n="next"===i?this._ascending:this._descending,t.sort(n)};let s=0;return r._addAlgorithm((i,o,a)=>{const l=i.key;for(;n(l,t[s])>0;)if(++s,s===t.length)return o(a),!1;return 0===n(l,t[s])||(o(()=>{i.continue(t[s])}),!1)}),r}notEqual(t){return this.inAnyRange([[Xt,t],[t,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})}noneOf(){const t=fe.apply(Ne,arguments);if(0===t.length)return new this.Collection(this);try{t.sort(this._ascending)}catch{return re(this,de)}const n=t.reduce((r,s)=>r?r.concat([[r[r.length-1][1],s]]):[[Xt,s]],null);return n.push([t[t.length-1],this.db._maxKey]),this.inAnyRange(n,{includeLowers:!1,includeUppers:!1})}inAnyRange(t,n){const r=this._cmp,s=this._ascending,i=this._descending,o=this._min,a=this._max;if(0===t.length)return We(this);if(!t.every(w=>void 0!==w[0]&&void 0!==w[1]&&s(w[0],w[1])<=0))return re(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",B.InvalidArgument);const l=!n||!1!==n.includeLowers,c=n&&!0===n.includeUppers;let d,u=s;function f(w,I){return u(w[0],I[0])}try{d=t.reduce(function h(w,I){let O=0,D=w.length;for(;O<D;++O){const b=w[O];if(r(I[0],b[1])<0&&r(I[1],b[0])>0){b[0]=o(b[0],I[0]),b[1]=a(b[1],I[1]);break}}return O===D&&w.push(I),w},[]),d.sort(f)}catch{return re(this,de)}let E=0;const m=c?w=>s(w,d[E][1])>0:w=>s(w,d[E][1])>=0,S=l?w=>i(w,d[E][0])>0:w=>i(w,d[E][0])>=0;let k=m;const x=new this.Collection(this,()=>be(d[0][0],d[d.length-1][1],!l,!c));return x._ondirectionchange=w=>{"next"===w?(k=m,u=s):(k=S,u=i),d.sort(f)},x._addAlgorithm((w,I,O)=>{for(var D=w.key;k(D);)if(++E,E===d.length)return I(O),!1;return!!function y(w){return!m(w)&&!S(w)}(D)||(0===this._cmp(D,d[E][1])||0===this._cmp(D,d[E][0])||I(()=>{w.continue(u===s?d[E][0]:d[E][1])}),!1)}),x}startsWithAnyOf(){const t=fe.apply(Ne,arguments);return t.every(n=>"string"==typeof n)?0===t.length?We(this):this.inAnyRange(t.map(n=>[n,n+Ce])):re(this,"startsWithAnyOf() only works with strings")}}function le(e){return G(function(t){return tt(t),e(t.target.error),!1})}function tt(e){e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault()}const nt="storagemutated",we="x-storagemutated-1",_e=Ze(null,nt);class is{_lock(){return je(!N.global),++this._reculock,1===this._reculock&&!N.global&&(N.lockOwnerFor=this),this}_unlock(){if(je(!N.global),0==--this._reculock)for(N.global||(N.lockOwnerFor=null);this._blockedFuncs.length>0&&!this._locked();){var t=this._blockedFuncs.shift();try{Le(t[1],t[0])}catch{}}return this}_locked(){return this._reculock&&N.lockOwnerFor!==this}create(t){if(!this.mode)return this;const n=this.db.idbdb,r=this.db._state.dbOpenError;if(je(!this.idbtrans),!t&&!n)switch(r&&r.name){case"DatabaseClosedError":throw new B.DatabaseClosed(r);case"MissingAPIError":throw new B.MissingAPI(r.message,r);default:throw new B.OpenFailed(r)}if(!this.active)throw new B.TransactionInactive;return je(null===this._completion._state),(t=this.idbtrans=t||(this.db.core?this.db.core.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability}):n.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability}))).onerror=G(s=>{tt(s),this._reject(t.error)}),t.onabort=G(s=>{tt(s),this.active&&this._reject(new B.Abort(t.error)),this.active=!1,this.on("abort").fire(s)}),t.oncomplete=G(()=>{this.active=!1,this._resolve(),"mutatedParts"in t&&_e.storagemutated.fire(t.mutatedParts)}),this}_promise(t,n,r){if("readwrite"===t&&"readwrite"!==this.mode)return $(new B.ReadOnly("Transaction is readonly"));if(!this.active)return $(new B.TransactionInactive);if(this._locked())return new T((i,o)=>{this._blockedFuncs.push([()=>{this._promise(t,n,r).then(i,o)},N])});if(r)return ge(()=>{var i=new T((o,a)=>{this._lock();const l=n(o,a,this);l&&l.then&&l.then(o,a)});return i.finally(()=>this._unlock()),i._lib=!0,i});var s=new T((i,o)=>{var a=n(i,o,this);a&&a.then&&a.then(i,o)});return s._lib=!0,s}_root(){return this.parent?this.parent._root():this}waitFor(t){var n=this._root();const r=T.resolve(t);if(n._waitingFor)n._waitingFor=n._waitingFor.then(()=>r);else{n._waitingFor=r,n._waitingQueue=[];var s=n.idbtrans.objectStore(n.storeNames[0]);!function o(){for(++n._spinCount;n._waitingQueue.length;)n._waitingQueue.shift()();n._waitingFor&&(s.get(-1/0).onsuccess=o)}()}var i=n._waitingFor;return new T((o,a)=>{r.then(l=>n._waitingQueue.push(G(o.bind(null,l))),l=>n._waitingQueue.push(G(a.bind(null,l)))).finally(()=>{n._waitingFor===i&&(n._waitingFor=null)})})}abort(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new B.Abort))}table(t){const n=this._memoizedTables||(this._memoizedTables={});if(se(n,t))return n[t];const r=this.schema[t];if(!r)throw new B.NotFound("Table "+t+" not part of transaction");const s=new this.db.Table(t,r,this);return s.core=this.db.core.table(t),n[t]=s,s}}function rn(e,t,n,r,s,i,o){return{name:e,keyPath:t,unique:n,multi:r,auto:s,compound:i,src:(n&&!o?"&":"")+(r?"*":"")+(s?"++":"")+nr(t)}}function nr(e){return"string"==typeof e?e:e?"["+[].join.call(e,"+")+"]":""}function rr(e,t,n){return{name:e,primKey:t,indexes:n,mappedClass:null,idxByName:xn(n,r=>[r.name,r])}}let rt=e=>{try{return e.only([[]]),rt=()=>[[]],[[]]}catch{return rt=()=>Ce,Ce}};function sn(e){return null==e?()=>{}:"string"==typeof e?function ls(e){return 1===e.split(".").length?n=>n[e]:n=>ue(n,e)}(e):t=>ue(t,e)}function sr(e){return[].slice.call(e)}let cs=0;function st(e){return null==e?":id":"string"==typeof e?e:`[${e.join("+")}]`}function us(e,t,n){function s(h){if(3===h.type)return null;if(4===h.type)throw new Error("Cannot convert never type to IDBKeyRange");const{lower:u,upper:f,lowerOpen:d,upperOpen:E}=h;return void 0===u?void 0===f?null:t.upperBound(f,!!E):void 0===f?t.lowerBound(u,!!d):t.bound(u,f,!!d,!!E)}const{schema:o,hasGetAll:a}=function r(h,u){const f=sr(h.objectStoreNames);return{schema:{name:h.name,tables:f.map(d=>u.objectStore(d)).map(d=>{const{keyPath:E,autoIncrement:m}=d,S=X(E),k={},x={name:d.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:null==E,compound:S,keyPath:E,autoIncrement:m,unique:!0,extractKey:sn(E)},indexes:sr(d.indexNames).map(w=>d.index(w)).map(w=>{const{name:I,unique:O,multiEntry:D,keyPath:b}=w,C={name:I,compound:X(b),keyPath:b,unique:O,multiEntry:D,extractKey:sn(b)};return k[st(b)]=C,C}),getIndexByKeyPath:w=>k[st(w)]};return k[":id"]=x.primaryKey,null!=E&&(k[st(E)]=x.primaryKey),x})},hasGetAll:f.length>0&&"getAll"in u.objectStore(f[0])&&!(typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)}}(e,n),l=o.tables.map(h=>function i(h){const u=h.name;return{name:u,schema:h,mutate:function f({trans:m,type:S,keys:y,values:k,range:x}){return new Promise((w,I)=>{w=G(w);const O=m.objectStore(u),D=null==O.keyPath,b="put"===S||"add"===S;if(!b&&"delete"!==S&&"deleteRange"!==S)throw new Error("Invalid operation type: "+S);const{length:p}=y||k||{length:1};if(y&&k&&y.length!==k.length)throw new Error("Given keys array must have same length as given values array.");if(0===p)return w({numFailures:0,failures:{},results:[],lastResult:void 0});let C;const R=[],L=[];let A=0;const j=V=>{++A,tt(V)};if("deleteRange"===S){if(4===x.type)return w({numFailures:A,failures:L,results:[],lastResult:void 0});R.push(C=3===x.type?O.clear():O.delete(s(x)))}else{const[V,q]=b?D?[k,y]:[k,null]:[y,null];if(b)for(let F=0;F<p;++F)R.push(C=q&&void 0!==q[F]?O[S](V[F],q[F]):O[S](V[F])),C.onerror=j;else for(let F=0;F<p;++F)R.push(C=O[S](V[F])),C.onerror=j}const v=V=>{const q=V.target.result;R.forEach((F,W)=>null!=F.error&&(L[W]=F.error)),w({numFailures:A,failures:L,results:"delete"===S?y:R.map(F=>F.result),lastResult:q})};C.onerror=V=>{j(V),v(V)},C.onsuccess=v})},getMany:({trans:m,keys:S})=>new Promise((y,k)=>{y=G(y);const x=m.objectStore(u),w=S.length,I=new Array(w);let b,O=0,D=0;const p=R=>{const L=R.target;I[L._pos]=L.result,++D===O&&y(I)},C=le(k);for(let R=0;R<w;++R)null!=S[R]&&(b=x.get(S[R]),b._pos=R,b.onsuccess=p,b.onerror=C,++O);0===O&&y(I)}),get:({trans:m,key:S})=>new Promise((y,k)=>{y=G(y);const w=m.objectStore(u).get(S);w.onsuccess=I=>y(I.target.result),w.onerror=le(k)}),query:function E(m){return S=>new Promise((y,k)=>{y=G(y);const{trans:x,values:w,limit:I,query:O}=S,D=I===1/0?void 0:I,{index:b,range:p}=O,C=x.objectStore(u),R=b.isPrimaryKey?C:C.index(b.name),L=s(p);if(0===I)return y({result:[]});if(m){const A=w?R.getAll(L,D):R.getAllKeys(L,D);A.onsuccess=j=>y({result:j.target.result}),A.onerror=le(k)}else{let A=0;const j=w||!("openKeyCursor"in R)?R.openCursor(L):R.openKeyCursor(L),v=[];j.onsuccess=V=>{const q=j.result;return q?(v.push(w?q.value:q.primaryKey),++A===I?y({result:v}):void q.continue()):y({result:v})},j.onerror=le(k)}})}(a),openCursor:function d({trans:m,values:S,query:y,reverse:k,unique:x}){return new Promise((w,I)=>{w=G(w);const{index:O,range:D}=y,b=m.objectStore(u),p=O.isPrimaryKey?b:b.index(O.name),C=k?x?"prevunique":"prev":x?"nextunique":"next",R=S||!("openKeyCursor"in p)?p.openCursor(s(D),C):p.openKeyCursor(s(D),C);R.onerror=le(I),R.onsuccess=G(L=>{const A=R.result;if(!A)return void w(null);A.___id=++cs,A.done=!1;const j=A.continue.bind(A);let v=A.continuePrimaryKey;v&&(v=v.bind(A));const V=A.advance.bind(A),F=()=>{throw new Error("Cursor not stopped")};A.trans=m,A.stop=A.continue=A.continuePrimaryKey=A.advance=()=>{throw new Error("Cursor not started")},A.fail=G(I),A.next=function(){let W=1;return this.start(()=>W--?this.continue():this.stop()).then(()=>this)},A.start=W=>{const J=new Promise((Y,Ve)=>{Y=G(Y),R.onerror=le(Ve),A.fail=Ve,A.stop=ri=>{A.stop=A.continue=A.continuePrimaryKey=A.advance=F,Y(ri)}}),ne=()=>{if(R.result)try{W()}catch(Y){A.fail(Y)}else A.done=!0,A.start=()=>{throw new Error("Cursor behind last entry")},A.stop()};return R.onsuccess=G(Y=>{R.onsuccess=ne,ne()}),A.continue=j,A.continuePrimaryKey=v,A.advance=V,ne(),J},w(A)},I)})},count({query:m,trans:S}){const{index:y,range:k}=m;return new Promise((x,w)=>{const I=S.objectStore(u),O=y.isPrimaryKey?I:I.index(y.name),D=s(k),b=D?O.count(D):O.count();b.onsuccess=G(p=>x(p.target.result)),b.onerror=le(w)})}}}(h)),c={};return l.forEach(h=>c[h.name]=h),{stack:"dbcore",transaction:e.transaction.bind(e),table(h){if(!c[h])throw new Error(`Table '${h}' not found`);return c[h]},MIN_KEY:-1/0,MAX_KEY:rt(t),schema:o}}function fs(e,t){return t.reduce((n,{create:r})=>({...n,...r(n)}),e)}function on({_novip:e},t){const r=function hs(e,t,{IDBKeyRange:n},s){return{dbcore:fs(us(t,n,s),e.dbcore)}}(e._middlewares,t.db,e._deps,t);e.core=r.dbcore,e.tables.forEach(s=>{const i=s.name;e.core.schema.tables.some(o=>o.name===i)&&(s.core=e.core.table(i),e[i]instanceof e.Table&&(e[i].core=s.core))})}function kt({_novip:e},t,n,r){n.forEach(s=>{const i=r[s];t.forEach(o=>{const a=Tt(o,s);(!a||"value"in a&&void 0===a.value)&&(o===e.Transaction.prototype||o instanceof e.Transaction?ce(o,s,{get(){return this.table(s)},set(l){_n(this,s,{value:l,writable:!0,configurable:!0,enumerable:!0})}}):o[s]=new e.Table(s,i))})})}function an({_novip:e},t){t.forEach(n=>{for(let r in n)n[r]instanceof e.Table&&delete n[r]})}function ds(e,t){return e._cfg.version-t._cfg.version}function ir(e,t){const n={del:[],add:[],change:[]};let r;for(r in e)t[r]||n.del.push(r);for(r in t){const s=e[r],i=t[r];if(s){const o={name:r,def:i,recreate:!1,del:[],add:[],change:[]};if(""+(s.primKey.keyPath||"")!=""+(i.primKey.keyPath||"")||s.primKey.auto!==i.primKey.auto&&!_t)o.recreate=!0,n.change.push(o);else{const a=s.idxByName,l=i.idxByName;let c;for(c in a)l[c]||o.del.push(c);for(c in l){const h=a[c],u=l[c];h?h.src!==u.src&&o.change.push(u):o.add.push(u)}(o.del.length>0||o.add.length>0||o.change.length>0)&&n.change.push(o)}}else n.add.push([r,i])}return n}function ln(e,t,n,r){const s=e.db.createObjectStore(t,n.keyPath?{keyPath:n.keyPath,autoIncrement:n.auto}:{autoIncrement:n.auto});return r.forEach(i=>cn(s,i)),s}function cn(e,t){e.createIndex(t.name,t.keyPath,{unique:t.unique,multiEntry:t.multi})}function un(e,t,n){const r={};return at(t.objectStoreNames,0).forEach(i=>{const o=n.objectStore(i);let a=o.keyPath;const l=rn(nr(a),a||"",!1,!1,!!o.autoIncrement,a&&"string"!=typeof a,!0),c=[];for(let u=0;u<o.indexNames.length;++u){const f=o.index(o.indexNames[u]);a=f.keyPath;var h=rn(f.name,a,!!f.unique,!!f.multiEntry,!1,a&&"string"!=typeof a,!1);c.push(h)}r[i]=rr(i,l,c)}),r}function fn({_novip:e},t,n){const r=n.db.objectStoreNames;for(let s=0;s<r.length;++s){const i=r[s],o=n.objectStore(i);e._hasGetAll="getAll"in o;for(let a=0;a<o.indexNames.length;++a){const l=o.indexNames[a],c=o.index(l).keyPath,h="string"==typeof c?c:"["+at(c).join("+")+"]";if(t[i]){const u=t[i].idxByName[h];u&&(u.name=l,delete t[i].idxByName[h],t[i].idxByName[l]=u)}}}typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&U.WorkerGlobalScope&&U instanceof U.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(e._hasGetAll=!1)}class _s{_parseStoresSpec(t,n){z(t).forEach(r=>{if(null!==t[r]){var s=function ws(e){return e.split(",").map((t,n)=>{const r=(t=t.trim()).replace(/([&*]|\+\+)/g,""),s=/^\[/.test(r)?r.match(/^\[(.*)\]$/)[1].split("+"):r;return rn(r,s||null,/\&/.test(t),/\*/.test(t),/\+\+/.test(t),X(s),0===n)})}(t[r]),i=s.shift();if(i.multi)throw new B.Schema("Primary key cannot be multi-valued");s.forEach(o=>{if(o.auto)throw new B.Schema("Only primary key can be marked as autoIncrement (++)");if(!o.keyPath)throw new B.Schema("Index must have a name and cannot be an empty string")}),n[r]=rr(r,i,s)}})}stores(t){const n=this.db;this._cfg.storesSource=this._cfg.storesSource?ee(this._cfg.storesSource,t):t;const s={};let i={};return n._versions.forEach(o=>{ee(s,o._cfg.storesSource),i=o._cfg.dbschema={},o._parseStoresSpec(s,i)}),n._dbSchema=i,an(n,[n._allTables,n,n.Transaction.prototype]),kt(n,[n._allTables,n,n.Transaction.prototype,this._cfg.tables],z(i),i),n._storeNames=z(i),this}upgrade(t){return this._cfg.contentUpgrade=Lt(this._cfg.contentUpgrade||H,t),this}}function hn(e,t){let n=e._dbNamesDB;return n||(n=e._dbNamesDB=new Ie(St,{addons:[],indexedDB:e,IDBKeyRange:t}),n.version(1).stores({dbnames:"name"})),n.table("dbnames")}function dn(e){return e&&"function"==typeof e.databases}function mn(e){return ge(function(){return N.letThrough=!0,e()})}function Cs(){var t;return!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent)&&indexedDB.databases?new Promise(function(n){var r=function(){return indexedDB.databases().finally(n)};t=setInterval(r,100),r()}).finally(function(){return clearInterval(t)}):Promise.resolve()}function ks(e){const t=e._state,{indexedDB:n}=e._deps;if(t.isBeingOpened||e.idbdb)return t.dbReadyPromise.then(()=>t.dbOpenError?$(t.dbOpenError):e);ae&&(t.openCanceller._stackHolder=Se()),t.isBeingOpened=!0,t.dbOpenError=null,t.openComplete=!1;const r=t.openCanceller;function s(){if(t.openCanceller!==r)throw new B.DatabaseClosed("db.open() was cancelled")}let i=t.dbReadyResolve,o=null,a=!1;return T.race([r,(typeof navigator>"u"?T.resolve():Cs()).then(()=>new T((l,c)=>{if(s(),!n)throw new B.MissingAPI;const h=e.name,u=t.autoSchema?n.open(h):n.open(h,Math.round(10*e.verno));if(!u)throw new B.MissingAPI;u.onerror=le(c),u.onblocked=G(e._fireOnBlocked),u.onupgradeneeded=G(f=>{if(o=u.transaction,t.autoSchema&&!e._options.allowEmptyDB){u.onerror=tt,o.abort(),u.result.close();const E=n.deleteDatabase(h);E.onsuccess=E.onerror=G(()=>{c(new B.NoSuchDatabase(`Database ${h} doesnt exist`))})}else{o.onerror=le(c);var d=f.oldVersion>Math.pow(2,62)?0:f.oldVersion;a=d<1,e._novip.idbdb=u.result,function ms(e,t,n,r){const s=e._dbSchema,i=e._createTransaction("readwrite",e._storeNames,s);i.create(n),i._completion.catch(r);const o=i._reject.bind(i),a=N.transless||N;ge(()=>{N.trans=i,N.transless=a,0===t?(z(s).forEach(l=>{ln(n,l,s[l].primKey,s[l].indexes)}),on(e,n),T.follow(()=>e.on.populate.fire(i)).catch(o)):function ps({_novip:e},t,n,r){const s=[],i=e._versions;let o=e._dbSchema=un(0,e.idbdb,r),a=!1;return i.filter(h=>h._cfg.version>=t).forEach(h=>{s.push(()=>{const u=o,f=h._cfg.dbschema;fn(e,u,r),fn(e,f,r),o=e._dbSchema=f;const d=ir(u,f);d.add.forEach(m=>{ln(r,m[0],m[1].primKey,m[1].indexes)}),d.change.forEach(m=>{if(m.recreate)throw new B.Upgrade("Not yet support for changing primary key");{const S=r.objectStore(m.name);m.add.forEach(y=>cn(S,y)),m.change.forEach(y=>{S.deleteIndex(y.name),cn(S,y)}),m.del.forEach(y=>S.deleteIndex(y))}});const E=h._cfg.contentUpgrade;if(E&&h._cfg.version>t){on(e,r),n._memoizedTables={},a=!0;let m=An(f);d.del.forEach(x=>{m[x]=u[x]}),an(e,[e.Transaction.prototype]),kt(e,[e.Transaction.prototype],z(m),m),n.schema=m;const S=Kt(E);let y;S&&Be();const k=T.follow(()=>{if(y=E(n),y&&S){var x=he.bind(null,null);y.then(x,x)}});return y&&"function"==typeof y.then?T.resolve(y):k.then(()=>y)}}),s.push(u=>{a&&Hr||function gs(e,t){[].slice.call(t.db.objectStoreNames).forEach(n=>null==e[n]&&t.db.deleteObjectStore(n))}(h._cfg.dbschema,u),an(e,[e.Transaction.prototype]),kt(e,[e.Transaction.prototype],e._storeNames,e._dbSchema),n.schema=e._dbSchema})}),function c(){return s.length?T.resolve(s.shift()(n.idbtrans)).then(c):T.resolve()}().then(()=>{!function ys(e,t){z(e).forEach(n=>{t.db.objectStoreNames.contains(n)||ln(t,n,e[n].primKey,e[n].indexes)})}(o,r)})}(e,t,i,n).catch(o)})}(e,d/10,o,c)}},c),u.onsuccess=G(()=>{o=null;const f=e._novip.idbdb=u.result,d=at(f.objectStoreNames);if(d.length>0)try{const E=f.transaction(function as(e){return 1===e.length?e[0]:e}(d),"readonly");t.autoSchema?function vs({_novip:e},t,n){e.verno=t.version/10;const r=e._dbSchema=un(0,t,n);e._storeNames=at(t.objectStoreNames,0),kt(e,[e._allTables],z(r),r)}(e,f,E):(fn(e,e._dbSchema,E),function bs(e,t){const r=ir(un(0,e.idbdb,t),e._dbSchema);return!(r.add.length||r.change.some(s=>s.add.length||s.change.length))}(e,E)||console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Some queries may fail.")),on(e,E)}catch{}Qe.push(e),f.onversionchange=G(E=>{t.vcFired=!0,e.on("versionchange").fire(E)}),f.onclose=G(E=>{e.on("close").fire(E)}),a&&function xs({indexedDB:e,IDBKeyRange:t},n){!dn(e)&&n!==St&&hn(e,t).put({name:n}).catch(H)}(e._deps,h),l()},c)}))]).then(()=>(s(),t.onReadyBeingFired=[],T.resolve(mn(()=>e.on.ready.fire(e.vip))).then(function l(){if(t.onReadyBeingFired.length>0){let c=t.onReadyBeingFired.reduce(Lt,H);return t.onReadyBeingFired=[],T.resolve(mn(()=>c(e.vip))).then(l)}}))).finally(()=>{t.onReadyBeingFired=null,t.isBeingOpened=!1}).then(()=>e).catch(l=>{t.dbOpenError=l;try{o&&o.abort()}catch{}return r===t.openCanceller&&e._close(),$(l)}).finally(()=>{t.openComplete=!0,i()})}function pn(e){var t=o=>e.next(o),r=i(t),s=i(o=>e.throw(o));function i(o){return a=>{var l=o(a),c=l.value;return l.done?c:c&&"function"==typeof c.then?c.then(r,s):X(c)?Promise.all(c).then(r,s):r(c)}}return i(t)()}function Is(e,t,n){var r=arguments.length;if(r<2)throw new B.InvalidArgument("Too few arguments");for(var s=new Array(r-1);--r;)s[r-1]=arguments[r];n=s.pop();var i=Cn(s);return[e,i,n]}function Os(e,t,n,r,s){return T.resolve().then(()=>{const i=N.transless||N,o=e._createTransaction(t,n,e._dbSchema,r),a={trans:o,transless:i};r?o.idbtrans=r.idbtrans:o.create();const l=Kt(s);let c;l&&Be();const h=T.follow(()=>{if(c=s.call(o,o),c)if(l){var u=he.bind(null,null);c.then(u,u)}else"function"==typeof c.next&&"function"==typeof c.throw&&(c=pn(c))},a);return(c&&"function"==typeof c.then?T.resolve(c).then(u=>o.active?u:$(new B.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))):h.then(()=>c)).then(u=>(r&&o._resolve(),o._completion.then(()=>u))).catch(u=>(o._reject(u),$(u)))})}function It(e,t,n){const r=X(e)?e.slice():[e];for(let s=0;s<n;++s)r.push(t);return r}const Ts={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:function Rs(e){return{...e,table(t){const n=e.table(t),{schema:r}=n,s={},i=[];function o(f,d,E){const m=st(f),S=s[m]=s[m]||[],y=null==f?0:"string"==typeof f?1:f.length,k=d>0,x={...E,isVirtual:k,keyTail:d,keyLength:y,extractKey:sn(f),unique:!k&&E.unique};return S.push(x),x.isPrimaryKey||i.push(x),y>1&&o(2===y?f[0]:f.slice(0,y-1),d+1,E),S.sort((w,I)=>w.keyTail-I.keyTail),x}const a=o(r.primaryKey.keyPath,0,r.primaryKey);s[":id"]=[a];for(const f of r.indexes)o(f.keyPath,0,f);function c(f,d){return{type:1===f.type?2:f.type,lower:It(f.lower,f.lowerOpen?e.MAX_KEY:e.MIN_KEY,d),lowerOpen:!0,upper:It(f.upper,f.upperOpen?e.MIN_KEY:e.MAX_KEY,d),upperOpen:!0}}function h(f){const d=f.query.index;return d.isVirtual?{...f,query:{index:d,range:c(f.query.range,d.keyTail)}}:f}return{...n,schema:{...r,primaryKey:a,indexes:i,getIndexByKeyPath:function l(f){const d=s[st(f)];return d&&d[0]}},count:f=>n.count(h(f)),query:f=>n.query(h(f)),openCursor(f){const{keyTail:d,isVirtual:E,keyLength:m}=f.query.index;return E?n.openCursor(h(f)).then(y=>y&&function S(y){return Object.create(y,{continue:{value:function k(w){null!=w?y.continue(It(w,f.reverse?e.MAX_KEY:e.MIN_KEY,d)):f.unique?y.continue(y.key.slice(0,m).concat(f.reverse?e.MIN_KEY:e.MAX_KEY,d)):y.continue()}},continuePrimaryKey:{value(w,I){y.continuePrimaryKey(It(w,e.MAX_KEY,d),I)}},primaryKey:{get:()=>y.primaryKey},key:{get(){const w=y.key;return 1===m?w[0]:w.slice(0,m)}},value:{get:()=>y.value}})}(y)):n.openCursor(f)}}}}}};function yn(e,t,n,r){return n=n||{},r=r||"",z(e).forEach(s=>{if(se(t,s)){var i=e[s],o=t[s];if("object"==typeof i&&"object"==typeof o&&i&&o){const a=Pt(i);a!==Pt(o)?n[r+s]=t[s]:"Object"===a?yn(i,o,n,r+s+"."):i!==o&&(n[r+s]=t[s])}else i!==o&&(n[r+s]=t[s])}else n[r+s]=void 0}),z(t).forEach(s=>{se(e,s)||(n[r+s]=t[s])}),n}const Ps={stack:"dbcore",name:"HooksMiddleware",level:2,create:e=>({...e,table(t){const n=e.table(t),{primaryKey:r}=n.schema;return{...n,mutate(i){const o=N.trans,{deleting:a,creating:l,updating:c}=o.table(t).hook;switch(i.type){case"add":if(l.fire===H)break;return o._promise("readwrite",()=>h(i),!0);case"put":if(l.fire===H&&c.fire===H)break;return o._promise("readwrite",()=>h(i),!0);case"delete":if(a.fire===H)break;return o._promise("readwrite",()=>h(i),!0);case"deleteRange":if(a.fire===H)break;return o._promise("readwrite",()=>function u(d){return f(d.trans,d.range,1e4)}(i),!0)}return n.mutate(i);function h(d){const E=N.trans,m=d.keys||function Ds(e,t){return"delete"===t.type?t.keys:t.keys||t.values.map(e.extractKey)}(r,d);if(!m)throw new Error("Keys missing");return"delete"!==(d="add"===d.type||"put"===d.type?{...d,keys:m}:{...d}).type&&(d.values=[...d.values]),d.keys&&(d.keys=[...d.keys]),function Ns(e,t,n){return"add"===t.type?Promise.resolve([]):e.getMany({trans:t.trans,keys:n,cache:"immutable"})}(n,d,m).then(S=>{const y=m.map((k,x)=>{const w=S[x],I={onerror:null,onsuccess:null};if("delete"===d.type)a.fire.call(I,k,w,E);else if("add"===d.type||void 0===w){const O=l.fire.call(I,k,d.values[x],E);null==k&&null!=O&&(d.keys[x]=k=O,r.outbound||ie(d.values[x],r.keyPath,k))}else{const O=yn(w,d.values[x]),D=c.fire.call(I,O,k,w,E);if(D){const b=d.values[x];Object.keys(D).forEach(p=>{se(b,p)?b[p]=D[p]:ie(b,p,D[p])})}}return I});return n.mutate(d).then(({failures:k,results:x,numFailures:w,lastResult:I})=>{for(let O=0;O<m.length;++O){const D=x?x[O]:m[O],b=y[O];null==D?b.onerror&&b.onerror(k[O]):b.onsuccess&&b.onsuccess("put"===d.type&&S[O]?d.values[O]:D)}return{failures:k,results:x,numFailures:w,lastResult:I}}).catch(k=>(y.forEach(x=>x.onerror&&x.onerror(k)),Promise.reject(k)))})}function f(d,E,m){return n.query({trans:d,values:!1,query:{index:r,range:E},limit:m}).then(({result:S})=>h({type:"delete",keys:S,trans:d}).then(y=>y.numFailures>0?Promise.reject(y.failures[0]):S.length<m?{failures:[],numFailures:0,lastResult:void 0}:f(d,{...E,lower:S[S.length-1],lowerOpen:!0},m)))}}}}})};function or(e,t,n){try{if(!t||t.keys.length<e.length)return null;const r=[];for(let s=0,i=0;s<t.keys.length&&i<e.length;++s)0===te(t.keys[s],e[i])&&(r.push(n?He(t.values[s]):t.values[s]),++i);return r.length===e.length?r:null}catch{return null}}const Ks={stack:"dbcore",level:-1,create:e=>({table:t=>{const n=e.table(t);return{...n,getMany:r=>{if(!r.cache)return n.getMany(r);const s=or(r.keys,r.trans._cache,"clone"===r.cache);return s?T.resolve(s):n.getMany(r).then(i=>(r.trans._cache={keys:r.keys,values:"clone"===r.cache?He(i):i},i))},mutate:r=>("add"!==r.type&&(r.trans._cache=null),n.mutate(r))}}})};function gn(e){return!("from"in e)}const me=function(e,t){if(!this){const n=new me;return e&&"d"in e&&ee(n,e),n}ee(this,arguments.length?{d:1,from:e,to:arguments.length>1?t:e}:{d:0})};function it(e,t,n){const r=te(t,n);if(isNaN(r))return;if(r>0)throw RangeError();if(gn(e))return ee(e,{from:t,to:n,d:1});const s=e.l,i=e.r;if(te(n,e.from)<0)return s?it(s,t,n):e.l={from:t,to:n,d:1,l:null,r:null},ar(e);if(te(t,e.to)>0)return i?it(i,t,n):e.r={from:t,to:n,d:1,l:null,r:null},ar(e);te(t,e.from)<0&&(e.from=t,e.l=null,e.d=i?i.d+1:1),te(n,e.to)>0&&(e.to=n,e.r=null,e.d=e.l?e.l.d+1:1);const o=!e.r;s&&!e.l&&Ot(e,s),i&&o&&Ot(e,i)}function Ot(e,t){gn(t)||function n(r,{from:s,to:i,l:o,r:a}){it(r,s,i),o&&n(r,o),a&&n(r,a)}(e,t)}function vn(e){let t=gn(e)?null:{s:0,n:e};return{next(n){const r=arguments.length>0;for(;t;)switch(t.s){case 0:if(t.s=1,r)for(;t.n.l&&te(n,t.n.from)<0;)t={up:t,n:t.n.l,s:1};else for(;t.n.l;)t={up:t,n:t.n.l,s:1};case 1:if(t.s=2,!r||te(n,t.n.to)<=0)return{value:t.n,done:!1};case 2:if(t.n.r){t.s=3,t={up:t,n:t.n.r,s:0};continue}case 3:t=t.up}return{done:!0}}}}function ar(e){var t,n;const r=((null===(t=e.r)||void 0===t?void 0:t.d)||0)-((null===(n=e.l)||void 0===n?void 0:n.d)||0),s=r>1?"r":r<-1?"l":"";if(s){const i="r"===s?"l":"r",o={...e},a=e[s];e.from=a.from,e.to=a.to,e[s]=a[s],o[s]=a[i],e[i]=o,o.d=lr(o)}e.d=lr(e)}function lr({r:e,l:t}){return(e?t?Math.max(e.d,t.d):e.d:t?t.d:0)+1}De(me.prototype,{add(e){return Ot(this,e),this},addKey(e){return it(this,e,e),this},addKeys(e){return e.forEach(t=>it(this,t,t)),this},[Nt](){return vn(this)}});const Bs={stack:"dbcore",level:0,create:e=>{const t=e.schema.name,n=new me(e.MIN_KEY,e.MAX_KEY);return{...e,table:r=>{const s=e.table(r),{schema:i}=s,{primaryKey:o}=i,{extractKey:a,outbound:l}=o,c={...s,mutate:f=>{const d=f.trans,E=d.mutatedParts||(d.mutatedParts={}),m=O=>{const D=`idb://${t}/${r}/${O}`;return E[D]||(E[D]=new me)},S=m(""),y=m(":dels"),{type:k}=f;let[x,w]="deleteRange"===f.type?[f.range]:"delete"===f.type?[f.keys]:f.values.length<50?[[],f.values]:[];const I=f.trans._cache;return s.mutate(f).then(O=>{if(X(x)){"delete"!==k&&(x=O.results),S.addKeys(x);const D=or(x,I);!D&&"add"!==k&&y.addKeys(x),(D||w)&&function Ls(e,t,n,r){t.indexes.forEach(function s(i){const o=e(i.name||"");function a(c){return null!=c?i.extractKey(c):null}const l=c=>i.multiEntry&&X(c)?c.forEach(h=>o.addKey(h)):o.addKey(c);(n||r).forEach((c,h)=>{const u=n&&a(n[h]),f=r&&a(r[h]);0!==te(u,f)&&(null!=u&&l(u),null!=f&&l(f))})})}(m,i,D,w)}else if(x){const D={from:x.lower,to:x.upper};y.add(D),S.add(D)}else S.add(n),y.add(n),i.indexes.forEach(D=>m(D.name).add(n));return O})}},h=({query:{index:f,range:d}})=>{var E,m;return[f,new me(null!==(E=d.lower)&&void 0!==E?E:e.MIN_KEY,null!==(m=d.upper)&&void 0!==m?m:e.MAX_KEY)]},u={get:f=>[o,new me(f.key)],getMany:f=>[o,(new me).addKeys(f.keys)],count:h,query:h,openCursor:h};return z(u).forEach(f=>{c[f]=function(d){const{subscr:E}=N;if(E){const m=w=>{const I=`idb://${t}/${r}/${w}`;return E[I]||(E[I]=new me)},S=m(""),y=m(":dels"),[k,x]=u[f](d);if(m(k.name||"").add(x),!k.isPrimaryKey){if("count"!==f){const w="query"===f&&l&&d.values&&s.query({...d,values:!1});return s[f].apply(this,arguments).then(I=>{if("query"===f){if(l&&d.values)return w.then(({result:D})=>(S.addKeys(D),I));const O=d.values?I.result.map(a):I.result;d.values?S.addKeys(O):y.addKeys(O)}else if("openCursor"===f){const O=I,D=d.values;return O&&Object.create(O,{key:{get:()=>(y.addKey(O.primaryKey),O.key)},primaryKey:{get(){const b=O.primaryKey;return y.addKey(b),b}},value:{get:()=>(D&&S.addKey(O.primaryKey),O.value)}})}return I})}y.add(n)}}return s[f].apply(this,arguments)}}),c}}}};class Ie{constructor(t,n){this._middlewares={},this.verno=0;const r=Ie.dependencies;this._options=n={addons:Ie.addons,autoOpen:!0,indexedDB:r.indexedDB,IDBKeyRange:r.IDBKeyRange,...n},this._deps={indexedDB:n.indexedDB,IDBKeyRange:n.IDBKeyRange};const{addons:s}=n;this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this;const i={dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:H,dbReadyPromise:null,cancelOpen:H,openCanceller:null,autoSchema:!0};i.dbReadyPromise=new T(o=>{i.dbReadyResolve=o}),i.openCanceller=new T((o,a)=>{i.cancelOpen=a}),this._state=i,this.name=t,this.on=Ze(this,"populate","blocked","versionchange","close",{ready:[Lt,H]}),this.on.ready.subscribe=Sn(this.on.ready.subscribe,o=>(a,l)=>{Ie.vip(()=>{const c=this._state;if(c.openComplete)c.dbOpenError||T.resolve().then(a),l&&o(a);else if(c.onReadyBeingFired)c.onReadyBeingFired.push(a),l&&o(a);else{o(a);const h=this;l||o(function u(){h.on.ready.unsubscribe(a),h.on.ready.unsubscribe(u)})}})}),this.Collection=function Qr(e){return et(Xr.prototype,function(n,r){this.db=e;let s=$n,i=null;if(r)try{s=r()}catch(c){i=c}const o=n._ctx,a=o.table,l=a.hook.reading.fire;this._ctx={table:a,index:o.index,isPrimKey:!o.index||a.schema.primKey.keyPath&&o.index===a.schema.primKey.name,range:s,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:i,or:o.or,valueMapper:l!==Ge?l:null}})}(this),this.Table=function Yr(e){return et(Gr.prototype,function(n,r,s){this.db=e,this._tx=s,this.name=n,this.schema=r,this.hook=e._allTables[n]?e._allTables[n].hook:Ze(null,{creating:[Or,H],reading:[Ir,Ge],updating:[Tr,H],deleting:[Rr,H]})})}(this),this.Transaction=function os(e){return et(is.prototype,function(n,r,s,i,o){this.db=e,this.mode=n,this.storeNames=r,this.schema=s,this.chromeTransactionDurability=i,this.idbtrans=null,this.on=Ze(this,"complete","error","abort"),this.parent=o||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new T((a,l)=>{this._resolve=a,this._reject=l}),this._completion.then(()=>{this.active=!1,this.on.complete.fire()},a=>{var l=this.active;return this.active=!1,this.on.error.fire(a),this.parent?this.parent._reject(a):l&&this.idbtrans&&this.idbtrans.abort(),$(a)})})}(this),this.Version=function Ss(e){return et(_s.prototype,function(n){this.db=e,this._cfg={version:n,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}})}(this),this.WhereClause=function ss(e){return et(tr.prototype,function(n,r,s){this.db=e,this._ctx={table:n,index:":id"===r?null:r,or:s};const i=e._deps.indexedDB;if(!i)throw new B.MissingAPI;this._cmp=this._ascending=i.cmp.bind(i),this._descending=(o,a)=>i.cmp(a,o),this._max=(o,a)=>i.cmp(o,a)>0?o:a,this._min=(o,a)=>i.cmp(o,a)<0?o:a,this._IDBKeyRange=e._deps.IDBKeyRange})}(this),this.on("versionchange",o=>{o.newVersion>0?console.warn(`Another connection wants to upgrade database '${this.name}'. Closing db now to resume the upgrade.`):console.warn(`Another connection wants to delete database '${this.name}'. Closing db now to resume the delete request.`),this.close()}),this.on("blocked",o=>{!o.newVersion||o.newVersion<o.oldVersion?console.warn(`Dexie.delete('${this.name}') was blocked`):console.warn(`Upgrade '${this.name}' blocked by other connection holding version ${o.oldVersion/10}`)}),this._maxKey=rt(n.IDBKeyRange),this._createTransaction=(o,a,l,c)=>new this.Transaction(o,a,l,this._options.chromeTransactionDurability,c),this._fireOnBlocked=o=>{this.on("blocked").fire(o),Qe.filter(a=>a.name===this.name&&a!==this&&!a._state.vcFired).map(a=>a.on("versionchange").fire(o))},this.use(Ts),this.use(Ps),this.use(Bs),this.use(Ks),this.vip=Object.create(this,{_vip:{value:!0}}),s.forEach(o=>o(this))}version(t){if(isNaN(t)||t<.1)throw new B.Type("Given version is not a positive number");if(t=Math.round(10*t)/10,this.idbdb||this._state.isBeingOpened)throw new B.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,t);const n=this._versions;var r=n.filter(s=>s._cfg.version===t)[0];return r||(r=new this.Version(t),n.push(r),n.sort(ds),r.stores({}),this._state.autoSchema=!1,r)}_whenReady(t){return this.idbdb&&(this._state.openComplete||N.letThrough||this._vip)?t():new T((n,r)=>{if(this._state.openComplete)return r(new B.DatabaseClosed(this._state.dbOpenError));if(!this._state.isBeingOpened){if(!this._options.autoOpen)return void r(new B.DatabaseClosed);this.open().catch(H)}this._state.dbReadyPromise.then(n,r)}).then(t)}use({stack:t,create:n,level:r,name:s}){s&&this.unuse({stack:t,name:s});const i=this._middlewares[t]||(this._middlewares[t]=[]);return i.push({stack:t,create:n,level:r??10,name:s}),i.sort((o,a)=>o.level-a.level),this}unuse({stack:t,name:n,create:r}){return t&&this._middlewares[t]&&(this._middlewares[t]=this._middlewares[t].filter(s=>r?s.create!==r:!!n&&s.name!==n)),this}open(){return ks(this)}_close(){const t=this._state,n=Qe.indexOf(this);if(n>=0&&Qe.splice(n,1),this.idbdb){try{this.idbdb.close()}catch{}this._novip.idbdb=null}t.dbReadyPromise=new T(r=>{t.dbReadyResolve=r}),t.openCanceller=new T((r,s)=>{t.cancelOpen=s})}close(){this._close();const t=this._state;this._options.autoOpen=!1,t.dbOpenError=new B.DatabaseClosed,t.isBeingOpened&&t.cancelOpen(t.dbOpenError)}delete(){const t=arguments.length>0,n=this._state;return new T((r,s)=>{const i=()=>{this.close();var o=this._deps.indexedDB.deleteDatabase(this.name);o.onsuccess=G(()=>{(function As({indexedDB:e,IDBKeyRange:t},n){!dn(e)&&n!==St&&hn(e,t).delete(n).catch(H)})(this._deps,this.name),r()}),o.onerror=le(s),o.onblocked=this._fireOnBlocked};if(t)throw new B.InvalidArgument("Arguments not allowed in db.delete()");n.isBeingOpened?n.dbReadyPromise.then(i):i()})}backendDB(){return this.idbdb}isOpen(){return null!==this.idbdb}hasBeenClosed(){const t=this._state.dbOpenError;return t&&"DatabaseClosed"===t.name}hasFailed(){return null!==this._state.dbOpenError}dynamicallyOpened(){return this._state.autoSchema}get tables(){return z(this._allTables).map(t=>this._allTables[t])}transaction(){const t=Is.apply(this,arguments);return this._transaction.apply(this,t)}_transaction(t,n,r){let s=N.trans;(!s||s.db!==this||-1!==t.indexOf("!"))&&(s=null);const i=-1!==t.indexOf("?");let o,a;t=t.replace("!","").replace("?","");try{if(a=n.map(c=>{var h=c instanceof this.Table?c.name:c;if("string"!=typeof h)throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return h}),"r"==t||t===Qt)o=Qt;else{if("rw"!=t&&t!=Zt)throw new B.InvalidArgument("Invalid transaction mode: "+t);o=Zt}if(s){if(s.mode===Qt&&o===Zt){if(!i)throw new B.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");s=null}s&&a.forEach(c=>{if(s&&-1===s.storeNames.indexOf(c)){if(!i)throw new B.SubTransaction("Table "+c+" not included in parent transaction.");s=null}}),i&&s&&!s.active&&(s=null)}}catch(c){return s?s._promise(null,(h,u)=>{u(c)}):$(c)}const l=Os.bind(null,this,o,a,s,r);return s?s._promise(o,l,"lock"):N.trans?Le(N.transless,()=>this._whenReady(l)):this._whenReady(l)}table(t){if(!se(this._allTables,t))throw new B.InvalidTable(`Table ${t} does not exist`);return this._allTables[t]}}const Fs=typeof Symbol<"u"&&"observable"in Symbol?Symbol.observable:"@@observable";class Ws{constructor(t){this._subscribe=t}subscribe(t,n,r){return this._subscribe(t&&"function"!=typeof t?t:{next:t,error:n,complete:r})}[Fs](){return this}}function cr(e,t){return z(t).forEach(n=>{Ot(e[n]||(e[n]=new me),t[n])}),e}let bn;try{bn={indexedDB:U.indexedDB||U.mozIndexedDB||U.webkitIndexedDB||U.msIndexedDB,IDBKeyRange:U.IDBKeyRange||U.webkitIDBKeyRange}}catch{bn={indexedDB:null,IDBKeyRange:null}}const Oe=Ie;function Rt(e){let t=pe;try{pe=!0,_e.storagemutated.fire(e)}finally{pe=t}}De(Oe,{...ct,delete:e=>new Oe(e,{addons:[]}).delete(),exists:e=>new Oe(e,{addons:[]}).open().then(t=>(t.close(),!0)).catch("NoSuchDatabaseError",()=>!1),getDatabaseNames(e){try{return function Es({indexedDB:e,IDBKeyRange:t}){return dn(e)?Promise.resolve(e.databases()).then(n=>n.map(r=>r.name).filter(r=>r!==St)):hn(e,t).toCollection().primaryKeys()}(Oe.dependencies).then(e)}catch{return $(new B.MissingAPI)}},defineClass:()=>function e(t){ee(this,t)},ignoreTransaction:e=>N.trans?Le(N.transless,e):e(),vip:mn,async:function(e){return function(){try{var t=pn(e.apply(this,arguments));return t&&"function"==typeof t.then?t:T.resolve(t)}catch(n){return $(n)}}},spawn:function(e,t,n){try{var r=pn(e.apply(n,t||[]));return r&&"function"==typeof r.then?r:T.resolve(r)}catch(s){return $(s)}},currentTransaction:{get:()=>N.trans||null},waitFor:function(e,t){const n=T.resolve("function"==typeof e?Oe.ignoreTransaction(e):e).timeout(t||6e4);return N.trans?N.trans.waitFor(n):n},Promise:T,debug:{get:()=>ae,set:e=>{In(e,"dexie"===e?()=>!0:zn)}},derive:Pe,extend:ee,props:De,override:Sn,Events:Ze,on:_e,liveQuery:function Vs(e){return new Ws(t=>{const n=Kt(e);let s=!1,i={},o={};const a={get closed(){return s},unsubscribe:()=>{s=!0,_e.storagemutated.unsubscribe(u)}};t.start&&t.start(a);let l=!1,c=!1;function h(){return z(o).some(d=>i[d]&&function Ms(e,t){const n=vn(t);let r=n.next();if(r.done)return!1;let s=r.value;const i=vn(e);let o=i.next(s.from),a=o.value;for(;!r.done&&!o.done;){if(te(a.from,s.to)<=0&&te(a.to,s.from)>=0)return!0;te(s.from,a.from)<0?s=(r=n.next(a.from)).value:a=(o=i.next(s.from)).value}return!1}(i[d],o[d]))}const u=d=>{cr(i,d),h()&&f()},f=()=>{if(l||s)return;i={};const d={},E=function r(d){n&&Be();const E=()=>ge(e,{subscr:d,trans:null}),m=N.trans?Le(N.transless,E):E();return n&&m.then(he,he),m}(d);c||(_e(nt,u),c=!0),l=!0,Promise.resolve(E).then(m=>{l=!1,!s&&(h()?f():(i={},o=d,t.next&&t.next(m)))},m=>{l=!1,t.error&&t.error(m),a.unsubscribe()})};return f(),a})},extendObservabilitySet:cr,getByKeyPath:ue,setByKeyPath:ie,delByKeyPath:function gr(e,t){"string"==typeof t?ie(e,t,void 0):"length"in t&&[].map.call(t,function(n){ie(e,n,void 0)})},shallowClone:An,deepClone:He,getObjectDiff:yn,cmp:te,asap:En,minKey:Xt,addons:[],connections:Qe,errnames:Ar,dependencies:bn,semVer:"3.2.0",version:"3.2.0".split(".").map(e=>parseInt(e)).reduce((e,t,n)=>e+t/Math.pow(10,2*n))}),Oe.maxKey=rt(Oe.dependencies.IDBKeyRange),typeof dispatchEvent<"u"&&typeof addEventListener<"u"&&(_e(nt,e=>{if(!pe){let t;_t?(t=document.createEvent("CustomEvent"),t.initCustomEvent(we,!0,!0,e)):t=new CustomEvent(we,{detail:e}),pe=!0,dispatchEvent(t),pe=!1}}),addEventListener(we,({detail:e})=>{pe||Rt(e)}));let pe=!1;if(typeof BroadcastChannel<"u"){const e=new BroadcastChannel(we);_e(nt,t=>{pe||e.postMessage(t)}),e.onmessage=t=>{t.data&&Rt(t.data)}}else if(typeof self<"u"&&typeof navigator<"u"){_e(nt,t=>{try{pe||(typeof localStorage<"u"&&localStorage.setItem(we,JSON.stringify({trig:Math.random(),changedParts:t})),"object"==typeof self.clients&&[...self.clients.matchAll({includeUncontrolled:!0})].forEach(n=>n.postMessage({type:we,changedParts:t})))}catch{}}),addEventListener("storage",t=>{if(t.key===we){const n=JSON.parse(t.newValue);n&&Rt(n.changedParts)}});const e=self.document&&navigator.serviceWorker;e&&e.addEventListener("message",function qs({data:e}){e&&e.type===we&&Rt(e.changedParts)})}T.rejectionMapper=function kr(e,t){if(!e||e instanceof Ke||e instanceof TypeError||e instanceof SyntaxError||!e.name||!Dn[e.name])return e;var n=new Dn[e.name](t||e.message,e);return"stack"in e&&ce(n,"stack",{get:function(){return this.inner.stack}}),n},In(ae,zn);var P=(()=>{return(e=P||(P={}))[e.ArmorSlotNone=0]="ArmorSlotNone",e[e.ArmorSlotHelmet=1]="ArmorSlotHelmet",e[e.ArmorSlotGauntlet=2]="ArmorSlotGauntlet",e[e.ArmorSlotChest=3]="ArmorSlotChest",e[e.ArmorSlotLegs=4]="ArmorSlotLegs",e[e.ArmorSlotClass=5]="ArmorSlotClass",P;var e})(),_=(()=>{return(e=_||(_={}))[e.PowerfulFriends=0]="PowerfulFriends",e[e.RadiantLight=1]="RadiantLight",e[e.ProtectiveLight=100]="ProtectiveLight",e[e.ExtraReserves=101]="ExtraReserves",e[e.PreciselyCharged=102]="PreciselyCharged",e[e.StacksOnStacks=103]="StacksOnStacks",e[e.PrecisionCharge=104]="PrecisionCharge",e[e.SurpriseAttack=105]="SurpriseAttack",e[e.EnergyConverter=106]="EnergyConverter",e[e.ChargeHarvester=107]="ChargeHarvester",e[e.WhisperOfDurance=1e3]="WhisperOfDurance",e[e.WhisperOfChains=1001]="WhisperOfChains",e[e.WhisperOfConduction=1002]="WhisperOfConduction",e[e.WhisperOfShards=1003]="WhisperOfShards",e[e.WhisperOfHedrons=1100]="WhisperOfHedrons",e[e.WhisperOfBonds=1101]="WhisperOfBonds",e[e.WhisperOfHunger=1102]="WhisperOfHunger",e[e.WhisperOfFractures=1103]="WhisperOfFractures",e[e.EchoOfExpulsion=1200]="EchoOfExpulsion",e[e.EchoOfProvision=1201]="EchoOfProvision",e[e.EchoOfPersistence=1202]="EchoOfPersistence",e[e.EchoOfLeeching=1203]="EchoOfLeeching",e[e.EchoOfDomineering=1204]="EchoOfDomineering",e[e.EchoOfDilation=1205]="EchoOfDilation",e[e.EchoOfUndermining=1206]="EchoOfUndermining",e[e.EchoOfInstability=1207]="EchoOfInstability",e[e.EchoOfHarvest=1208]="EchoOfHarvest",e[e.EchoOfObscurity=1209]="EchoOfObscurity",e[e.EchoOfStarvation=1210]="EchoOfStarvation",e[e.EmberOfBenelovence=1300]="EmberOfBenelovence",e[e.EmberOfBeams=1301]="EmberOfBeams",e[e.EmberOfEmpyrean=1302]="EmberOfEmpyrean",e[e.EmberOfCombustion=1303]="EmberOfCombustion",e[e.EmberOfChar=1304]="EmberOfChar",e[e.EmberOfTempering=1305]="EmberOfTempering",e[e.EmberOfEruption=1306]="EmberOfEruption",e[e.EmberOfWonder=1307]="EmberOfWonder",e[e.EmberOfSearing=1308]="EmberOfSearing",e[e.SparkOfBrilliance=1400]="SparkOfBrilliance",e[e.SparkOfFeedback=1401]="SparkOfFeedback",e[e.SparkOfDischarge=1402]="SparkOfDischarge",e[e.SparkOfFocus=1403]="SparkOfFocus",e[e.SparkOfVolts=1404]="SparkOfVolts",e[e.SparkOfResistance=1405]="SparkOfResistance",e[e.SparkOfShock=1406]="SparkOfShock",_;var e})(),M=(()=>{return(e=M||(M={}))[e.CombatStyleMod=0]="CombatStyleMod",e[e.Stasis=1]="Stasis",e[e.Void=2]="Void",e[e.Solar=3]="Solar",e[e.Arc=4]="Arc",e[e.Strand=5]="Strand",M;var e})(),Z=(()=>{return(e=Z||(Z={}))[e.NONE=0]="NONE",e[e.MINOR_MOBILITY=1]="MINOR_MOBILITY",e[e.MAJOR_MOBILITY=2]="MAJOR_MOBILITY",e[e.MINOR_RESILIENCE=3]="MINOR_RESILIENCE",e[e.MAJOR_RESILIENCE=4]="MAJOR_RESILIENCE",e[e.MINOR_RECOVERY=5]="MINOR_RECOVERY",e[e.MAJOR_RECOVERY=6]="MAJOR_RECOVERY",e[e.MINOR_DISCIPLINE=7]="MINOR_DISCIPLINE",e[e.MAJOR_DISCIPLINE=8]="MAJOR_DISCIPLINE",e[e.MINOR_INTELLECT=9]="MINOR_INTELLECT",e[e.MAJOR_INTELLECT=10]="MAJOR_INTELLECT",e[e.MINOR_STRENGTH=11]="MINOR_STRENGTH",e[e.MAJOR_STRENGTH=12]="MAJOR_STRENGTH",Z;var e})(),g=(()=>{return(e=g||(g={}))[e.Mobility=0]="Mobility",e[e.Resilience=1]="Resilience",e[e.Recovery=2]="Recovery",e[e.Discipline=3]="Discipline",e[e.Intellect=4]="Intellect",e[e.Strength=5]="Strength",g;var e})();const oe={[Z.NONE]:[g.Strength,0,0,0],[Z.MINOR_MOBILITY]:[g.Mobility,5,1,204137529],[Z.MAJOR_MOBILITY]:[g.Mobility,10,3,3961599962],[Z.MINOR_RESILIENCE]:[g.Resilience,5,1,3682186345],[Z.MAJOR_RESILIENCE]:[g.Resilience,10,3,2850583378],[Z.MINOR_RECOVERY]:[g.Recovery,5,2,555005975],[Z.MAJOR_RECOVERY]:[g.Recovery,10,4,2645858828],[Z.MINOR_DISCIPLINE]:[g.Discipline,5,1,2623485440],[Z.MAJOR_DISCIPLINE]:[g.Discipline,10,3,4048838440],[Z.MINOR_INTELLECT]:[g.Intellect,5,2,1227870362],[Z.MAJOR_INTELLECT]:[g.Intellect,10,5,3355995799],[Z.MINOR_STRENGTH]:[g.Strength,5,1,3699676109],[Z.MAJOR_STRENGTH]:[g.Strength,10,3,3253038666]};var Re=(()=>{return(e=Re||(Re={}))[e.ClassAbilityRegenerationStat=10]="ClassAbilityRegenerationStat",Re;var e})(),K=(()=>{return(e=K||(K={}))[e.None=0]="None",e[e.SlotNightmare=1]="SlotNightmare",e[e.SlotArtificer=2]="SlotArtificer",e[e.SlotLastWish=3]="SlotLastWish",e[e.SlotGardenOfSalvation=4]="SlotGardenOfSalvation",e[e.SlotDeepStoneCrypt=5]="SlotDeepStoneCrypt",e[e.SlotVaultOfGlass=6]="SlotVaultOfGlass",e[e.PerkIronBanner=7]="PerkIronBanner",e[e.PerkUniformedOfficer=8]="PerkUniformedOfficer",e[e.SlotVowOfTheDisciple=9]="SlotVowOfTheDisciple",e[e.COUNT=10]="COUNT",K;var e})();const Hs={[_.PowerfulFriends]:{id:_.PowerfulFriends,name:"Powerful Friends",description:"When you become Charged with Light, nearby allies also become Charged with Light, if they are not already.",type:M.CombatStyleMod,bonus:[{stat:g.Mobility,value:20}],cost:4,requiredArmorAffinity:1,hash:1484685887},[_.RadiantLight]:{id:_.RadiantLight,name:"Radiant Light",description:"Casting your Super causes nearby allies to become Charged with Light.",type:M.CombatStyleMod,bonus:[{stat:g.Strength,value:20}],cost:3,requiredArmorAffinity:1,hash:2979815167},[_.ProtectiveLight]:{id:_.ProtectiveLight,name:"Protective Light",description:"While Charged with Light, you gain significant damage resistance against combatants when your shields are destroyed. This effect consumes all stacks of Charged with Light. The more stacks consumed, the longer the damage resistance lasts.",type:M.CombatStyleMod,bonus:[{stat:g.Strength,value:-10}],cost:2,requiredArmorAffinity:3,hash:3523075120},[_.ExtraReserves]:{id:_.ExtraReserves,name:"Extra Reserves",description:"While Charged with Light, defeating combatants with Void damage grants a chance to drop Special ammo. This effect consumes all stacks of Charged with Light. The more stacks you have, the higher your chance of gaining the ammo drop.",type:M.CombatStyleMod,bonus:[{stat:g.Intellect,value:-10}],cost:3,requiredArmorAffinity:3,hash:3523075121},[_.PreciselyCharged]:{id:_.PreciselyCharged,name:"Precisely Charged",description:"Become Charged with Light by getting multiple rapid precision final blows with Linear Fusion Rifles or Sniper Rifles.",type:M.CombatStyleMod,bonus:[{stat:g.Discipline,value:-10}],cost:1,requiredArmorAffinity:3,hash:3523075122},[_.StacksOnStacks]:{id:_.StacksOnStacks,name:"Stacks on Stacks",description:"Gain an extra stack of Charged with Light for every stack you gain.",type:M.CombatStyleMod,bonus:[{stat:g.Recovery,value:-10}],cost:4,requiredArmorAffinity:3,hash:3523075123},[_.PrecisionCharge]:{id:_.PrecisionCharge,name:"Precision Charge",description:"Become Charged with Light by rapidly defeating combatants with precision kills from Bows, Hand Cannons, and Scout Rifles.",type:M.CombatStyleMod,bonus:[{stat:g.Strength,value:-10}],cost:2,requiredArmorAffinity:3,hash:2263321584},[_.SurpriseAttack]:{id:_.SurpriseAttack,name:"Surprise Attack",description:"While Charged with Light, reloading or readying a Sidearm will consume all stacks of Charged with Light and convert them into stacks of a major damage buff, which are depleted as you damage combatants with that Sidearm.",type:M.CombatStyleMod,bonus:[{stat:g.Intellect,value:-10}],cost:1,requiredArmorAffinity:3,hash:2263321585},[_.EnergyConverter]:{id:_.EnergyConverter,name:"Energy Converter",description:"While Charged with Light, using your grenade attack grants you Super energy, consuming all stacks of Charged with Light. The more stacks you have, the more energy you gain, up to a maximum of 50% of your Super energy.",type:M.CombatStyleMod,bonus:[{stat:g.Discipline,value:-10}],cost:4,requiredArmorAffinity:3,hash:2263321586},[_.ChargeHarvester]:{id:_.ChargeHarvester,name:"Charge Harvester",description:"While you are not Charged with Light, any kill or assist has a small cumulative chance to cause you to become Charged with Light.",type:M.CombatStyleMod,bonus:[{stat:Re.ClassAbilityRegenerationStat,value:-10}],cost:3,requiredArmorAffinity:3,hash:2263321587},[_.WhisperOfDurance]:{id:_.WhisperOfDurance,name:"Whisper Of Durance",description:"Slow from your abilities lasts longer. For those abilities that linger, their duration will also increase.",type:M.Stasis,bonus:[{stat:g.Strength,value:10}],cost:1,requiredArmorAffinity:0,hash:3469412969},[_.WhisperOfChains]:{id:_.WhisperOfChains,name:"Whisper Of Chains",description:"While you are near frozen targets or a friendly Stasis crystal, you take reduced damage from targets.",type:M.Stasis,bonus:[{stat:g.Recovery,value:10}],cost:1,requiredArmorAffinity:0,hash:537774540},[_.WhisperOfShards]:{id:_.WhisperOfShards,name:"Whisper Of Shards",description:"Shattering a Stasis crystal temporarily boosts your grenade recharge rate. Shattering additional Stasis crystals increases the duration of this benefit.",type:M.Stasis,bonus:[{stat:g.Resilience,value:10}],cost:1,requiredArmorAffinity:0,hash:3469412975},[_.WhisperOfConduction]:{id:_.WhisperOfConduction,name:"Whisper Of Conduction",description:"Nearby Stasis shards track to your position.",type:M.Stasis,bonus:[{stat:g.Resilience,value:10},{stat:g.Intellect,value:10}],cost:1,requiredArmorAffinity:0,hash:2483898429},[_.WhisperOfBonds]:{id:_.WhisperOfBonds,name:"Whisper of Bonds",description:"Defeating frozen targets grants you Super energy.",type:M.Stasis,bonus:[{stat:g.Discipline,value:-10},{stat:g.Intellect,value:-10}],cost:1,requiredArmorAffinity:0,hash:3469412974},[_.WhisperOfHedrons]:{id:_.WhisperOfHedrons,name:"Whisper of Hedrons",description:"Dramatically increases weapon stability, weapon aim assist, Mobility, Resilience, and Recovery after freezing a target with Stasis.",type:M.Stasis,bonus:[{stat:g.Strength,value:-10}],cost:1,requiredArmorAffinity:0,hash:3469412970},[_.WhisperOfFractures]:{id:_.WhisperOfFractures,name:"Whisper of Fractures",description:"Your melee energy recharges faster when you are near two or more targets.",type:M.Stasis,bonus:[{stat:g.Discipline,value:-10}],cost:1,requiredArmorAffinity:0,hash:537774542},[_.WhisperOfHunger]:{id:_.WhisperOfHunger,name:"Whisper of Hunger",description:"Increases the melee energy gained from picking up Stasis shards.",type:M.Stasis,bonus:[{stat:g.Mobility,value:-10},{stat:g.Recovery,value:-10}],cost:1,requiredArmorAffinity:0,hash:2483898431},[_.EchoOfExpulsion]:{id:_.EchoOfExpulsion,name:"Echo of Expulsion",description:"Void ability final blows cause targets to explode.",type:M.Void,bonus:[{stat:g.Intellect,value:10}],cost:1,requiredArmorAffinity:0,hash:2272984665},[_.EchoOfProvision]:{id:_.EchoOfProvision,name:"Echo of Provision",description:"Damaging targets with grenades grants melee energy.",type:M.Void,bonus:[{stat:g.Strength,value:-10}],cost:1,requiredArmorAffinity:0,hash:2272984664},[_.EchoOfPersistence]:{id:_.EchoOfPersistence,name:"Echo of Persistence",description:"Void buffs applied to you (Invisibility, Overshield, and Devour) have increased duration.",type:M.Void,bonus:[{stat:Re.ClassAbilityRegenerationStat,value:-10}],cost:1,requiredArmorAffinity:0,hash:2272984671},[_.EchoOfLeeching]:{id:_.EchoOfLeeching,name:"Echo of Leeching",description:"Melee final blows start health regeneration for you and nearby allies.",type:M.Void,bonus:[{stat:g.Resilience,value:10}],cost:1,requiredArmorAffinity:0,hash:2272984670},[_.EchoOfDomineering]:{id:_.EchoOfDomineering,name:"Echo of Domineering",description:"After suppressing a target, you gain greatly increased Mobility for a short duration and your equipped weapon is reloaded from reserves.",type:M.Void,bonus:[{stat:g.Discipline,value:10}],cost:1,requiredArmorAffinity:0,hash:2272984657},[_.EchoOfDilation]:{id:_.EchoOfDilation,name:"Echo of Dilation",description:"While crouched, you sneak faster and gain enhanced radar resolution.",type:M.Void,bonus:[{stat:g.Mobility,value:10},{stat:g.Intellect,value:10}],cost:1,requiredArmorAffinity:0,hash:2272984656},[_.EchoOfUndermining]:{id:_.EchoOfUndermining,name:"Echo of Undermining",description:"Your Void grenades weaken targets.",type:M.Void,bonus:[{stat:g.Discipline,value:-20}],cost:1,requiredArmorAffinity:0,hash:2272984668},[_.EchoOfInstability]:{id:_.EchoOfInstability,name:"Echo of Instability",description:"Defeating targets with grenades grants Volatile Rounds to your Void weapons.",type:M.Void,bonus:[{stat:g.Strength,value:10}],cost:1,requiredArmorAffinity:0,hash:2661180600},[_.EchoOfObscurity]:{id:_.EchoOfObscurity,name:"Echo of Obscurity",description:"Finisher final blows grant Invisibility.",type:M.Void,bonus:[{stat:g.Recovery,value:10}],cost:1,requiredArmorAffinity:0,hash:2661180602},[_.EchoOfHarvest]:{id:_.EchoOfHarvest,name:"Echo of Harvest",description:"Defeating weakened targets with precision final blows will create an Orb of Power.",type:M.Void,bonus:[{stat:g.Intellect,value:-10}],cost:1,requiredArmorAffinity:0,hash:2661180601},[_.EchoOfStarvation]:{id:_.EchoOfStarvation,name:"Echo of Starvation",description:"Picking up an Orb of Power grants Devour.",type:M.Void,bonus:[{stat:g.Recovery,value:-10}],cost:1,requiredArmorAffinity:0,hash:2661180603},[_.EmberOfBenelovence]:{id:_.EmberOfBenelovence,name:"Ember of Benelovence",description:"Applying restoration, cure, or radiant to allies grants increased grenade, melee, and class ability regeneration for a short duration.",type:M.Solar,bonus:[{stat:g.Discipline,value:-10}],cost:1,requiredArmorAffinity:0,hash:362132292},[_.EmberOfBeams]:{id:_.EmberOfBeams,name:"Ember of Beams",description:"Your Solar Super projectiles have stronger target acquisition.",type:M.Solar,bonus:[{stat:g.Intellect,value:10}],cost:1,requiredArmorAffinity:0,hash:362132295},[_.EmberOfEmpyrean]:{id:_.EmberOfEmpyrean,name:"Ember of Empyrean",description:"Solar weapon or ability final blows extend the duration of restoration and radiant effects applied to you.",type:M.Solar,bonus:[{stat:g.Resilience,value:-10}],cost:1,requiredArmorAffinity:0,hash:362132294},[_.EmberOfCombustion]:{id:_.EmberOfCombustion,name:"Ember of Combustion",description:"Final blows with your Solar Super cause targets to ignite.",type:M.Solar,bonus:[{stat:g.Strength,value:10}],cost:1,requiredArmorAffinity:0,hash:362132289},[_.EmberOfChar]:{id:_.EmberOfChar,name:"Ember of Char",description:"Your Solar ignitions spread scorch to affected targets.",type:M.Solar,bonus:[{stat:g.Discipline,value:10}],cost:1,requiredArmorAffinity:0,hash:362132291},[_.EmberOfTempering]:{id:_.EmberOfTempering,name:"Ember of Tempering",description:"Solar weapon final blows grant you and your allies increased recovery for a short duration. Stacks 3 times.\nWhile Ember of Tempering is active, your weapons have increased airborne effectiveness.",type:M.Solar,bonus:[{stat:g.Recovery,value:-10}],cost:1,requiredArmorAffinity:0,hash:362132290},[_.EmberOfEruption]:{id:_.EmberOfEruption,name:"Ember of Eruption",description:"Your Solar ignitions have increased area of effect.",type:M.Solar,bonus:[{stat:g.Strength,value:10}],cost:1,requiredArmorAffinity:0,hash:1051276348},[_.EmberOfWonder]:{id:_.EmberOfWonder,name:"Ember of Wonder",description:"Rapidly defeating multiple targets with Solar ignitions generates an Orb of Power.",type:M.Solar,bonus:[{stat:g.Resilience,value:10}],cost:1,requiredArmorAffinity:0,hash:1051276350},[_.EmberOfSearing]:{id:_.EmberOfSearing,name:"Ember of Searing",description:"Defeating scorched targets grants melee energy.",type:M.Solar,bonus:[{stat:g.Recovery,value:10}],cost:1,requiredArmorAffinity:0,hash:1051276351},[_.SparkOfBrilliance]:{id:_.SparkOfBrilliance,name:"Spark of Brilliance",description:"Defeating a blinded target with precision damage creates a blinding explosion.",type:M.Arc,bonus:[{stat:g.Intellect,value:10}],cost:1,requiredArmorAffinity:0,hash:3277705905},[_.SparkOfFeedback]:{id:_.SparkOfFeedback,name:"Spark of Feedback",description:"Taking melee damage briefly increases your outgoing melee damage.",type:M.Arc,bonus:[{stat:g.Resilience,value:10}],cost:1,requiredArmorAffinity:0,hash:3277705907},[_.SparkOfDischarge]:{id:_.SparkOfDischarge,name:"Spark of Discharge",description:"Arc weapon final blows have a chance to create an Ionic Trace.",type:M.Arc,bonus:[{stat:g.Strength,value:-10}],cost:1,requiredArmorAffinity:0,hash:1727069362},[_.SparkOfFocus]:{id:_.SparkOfFocus,name:"Spark of Focus",description:"After sprinting for a short time, your class ability regeneration is increased.",type:M.Arc,bonus:[{stat:Re.ClassAbilityRegenerationStat,value:-10}],cost:1,requiredArmorAffinity:0,hash:1727069360},[_.SparkOfVolts]:{id:_.SparkOfVolts,name:"Spark of Volts",description:"After sprinting for a short time, your class ability regeneration is increased.",type:M.Arc,bonus:[{stat:g.Recovery,value:10}],cost:1,requiredArmorAffinity:0,hash:3277705904},[_.SparkOfResistance]:{id:_.SparkOfResistance,name:"Spark of Resistance",description:"While surrounded by combatants, you are more resistant to incoming damage.",type:M.Arc,bonus:[{stat:g.Strength,value:10}],cost:1,requiredArmorAffinity:0,hash:1727069366},[_.SparkOfShock]:{id:_.SparkOfShock,name:"Spark of Shock",description:"Your Arc grenades jolt targets.",type:M.Arc,bonus:[{stat:g.Discipline,value:-10}],cost:1,requiredArmorAffinity:0,hash:1727069364},[_.SparkOfShock]:{id:_.SparkOfShock,name:"Spark of Shock",description:"Your Arc grenades jolt targets.",type:M.Arc,bonus:[{stat:g.Discipline,value:-10}],cost:1,requiredArmorAffinity:0,hash:1727069364}};Array.prototype.addSorted=function(e){var r,t=0,n=this.length,s=!1;if(e>this[n])return this.push(e),this;if(e<this[t])return this.splice(t,0,e),this;for(;0==s;)e>this[r=~~((t+n)/2)]?t=r:n=r,n-t<=1&&(this.splice(n,0,e),s=!0);return this},Array.prototype.where=Array.prototype.where||function(e){for(var t=[],n=this.length,r=0;r<n;r++){var s=this[r];e(s)&&t.push(s)}return t};const fr=function js(e){const t=new Ie("d2armorpicker-v2");return t.version(16).stores({manifestArmor:"id++, hash, isExotic",inventoryArmor:"id++, itemInstanceId, isExotic, hash, name, masterworked, clazz"}).upgrade(function(){var n=ot(function*(r){yield e()});return function(r){return n.apply(this,arguments)}}()),t}(ot(function*(){})),Us=fr.table("inventoryArmor"),Gs=fr.table("manifestArmor");class Te{constructor(t){this.items=[],this.mobility={min:0,max:0,sum:0},this.resilience={min:0,max:0,sum:0},this.recovery={min:0,max:0,sum:0},this.discipline={min:0,max:0,sum:0},this.intellect={min:0,max:0,sum:0},this.strength={min:0,max:0,sum:0},this.containsExotics=!1,this.containsLegendaries=!1,this.allMasterworked=!1,this.elements=[],this.perks=[],this.allSameElement=!0,this.items=t;const n=this.items.map(l=>l.mobility),r=this.items.map(l=>l.resilience),s=this.items.map(l=>l.recovery),i=this.items.map(l=>l.discipline),o=this.items.map(l=>l.intellect),a=this.items.map(l=>l.strength);this.mobility.min=Math.min(...n),this.mobility.sum=n.reduce((l,c)=>l+c,0),this.resilience.min=Math.min(...r),this.resilience.sum=r.reduce((l,c)=>l+c,0),this.recovery.min=Math.min(...s),this.recovery.sum=s.reduce((l,c)=>l+c,0),this.discipline.min=Math.min(...i),this.discipline.sum=i.reduce((l,c)=>l+c,0),this.intellect.min=Math.min(...o),this.intellect.sum=o.reduce((l,c)=>l+c,0),this.strength.min=Math.min(...a),this.strength.sum=a.reduce((l,c)=>l+c,0),this.containsExotics=this._containsExotics,this.containsLegendaries=this._containsLegendaries,this.allMasterworked=this._allMasterworked,this.elements=t.map(l=>l.energyAffinity),this.perks=t.map(l=>l.perk),this.allSameElement=1==new Set(t).size}get _containsExotics(){return this.items.filter(t=>t.isExotic).length>0}get _containsLegendaries(){return this.items.filter(t=>!t.isExotic).length>0}get _allMasterworked(){return this.items.filter(t=>t.masterworked).length==this.items.length}}function Ys(e,t,n,r,s,i,o){let a=t.slice(),l=a[0];r.allMasterworked&&e.ignoreArmorAffinitiesOnMasterworkedItems||!r.allMasterworked&&e.ignoreArmorAffinitiesOnNonMasterworkedItems?l++:a[r.elements[0]]--,s.allMasterworked&&e.ignoreArmorAffinitiesOnMasterworkedItems||!s.allMasterworked&&e.ignoreArmorAffinitiesOnNonMasterworkedItems?l++:a[s.elements[0]]--,i.allMasterworked&&e.ignoreArmorAffinitiesOnMasterworkedItems||!i.allMasterworked&&e.ignoreArmorAffinitiesOnNonMasterworkedItems?l++:a[i.elements[0]]--,o.allMasterworked&&e.ignoreArmorAffinitiesOnMasterworkedItems||!o.allMasterworked&&e.ignoreArmorAffinitiesOnNonMasterworkedItems?l++:a[o.elements[0]]--;let c=Math.max(0,a[1])+Math.max(0,a[2])+Math.max(0,a[3])+Math.max(0,a[6])-l;var h=0;if(e.armorAffinities[P.ArmorSlotClass].fixed&&(h=e.armorAffinities[P.ArmorSlotClass].value),1==c&&(!e.armorAffinities[P.ArmorSlotClass].fixed||0==e.armorAffinities[P.ArmorSlotClass].value)){var u=!1;for(let f of[3,6,2,1])a[f]<=0||n.has(f)&&(u=!0,h=f);u&&c--}return{valid:c<=0,requiredClassItemElement:h}}function zs(e,t,n,r,s,i,o){var a=e.selectedExotics[0]||0;let l=t.slice();if((a<=0||r.items[0].hash!=a)&&e.armorPerks[P.ArmorSlotHelmet].fixed&&e.armorPerks[P.ArmorSlotHelmet].value!=K.None&&e.armorPerks[P.ArmorSlotHelmet].value!=r.perks[0])return{valid:!1};if((a<=0||s.items[0].hash!=a)&&e.armorPerks[P.ArmorSlotGauntlet].fixed&&e.armorPerks[P.ArmorSlotGauntlet].value!=K.None&&e.armorPerks[P.ArmorSlotGauntlet].value!=s.perks[0])return{valid:!1};if((a<=0||i.items[0].hash!=a)&&e.armorPerks[P.ArmorSlotChest].fixed&&e.armorPerks[P.ArmorSlotChest].value!=K.None&&e.armorPerks[P.ArmorSlotChest].value!=i.perks[0])return{valid:!1};if((a<=0||o.items[0].hash!=a)&&e.armorPerks[P.ArmorSlotLegs].fixed&&e.armorPerks[P.ArmorSlotLegs].value!=K.None&&e.armorPerks[P.ArmorSlotLegs].value!=o.perks[0])return{valid:!1};if(e.armorPerks[P.ArmorSlotClass].fixed&&e.armorPerks[P.ArmorSlotClass].value!=K.None&&!n.has(e.armorPerks[P.ArmorSlotClass].value))return{valid:!1};l[r.perks[0]]--,l[s.perks[0]]--,l[i.perks[0]]--,l[o.perks[0]]--,a>0&&(r.items[0].hash==a?l[e.armorPerks[r.items[0].slot].value]--:s.items[0].hash==a?l[e.armorPerks[s.items[0].slot].value]--:i.items[0].hash==a?l[e.armorPerks[i.items[0].slot].value]--:o.items[0].hash==a&&l[e.armorPerks[o.items[0].slot].value]--);let c=0;for(let f=1;f<K.COUNT;f++)c+=Math.max(0,l[f]);var h=K.None;if(1==c){var u=!1;for(let f=1;f<K.COUNT&&!u;f++)l[f]<=0||n.has(f)&&(u=!0,h=f);u&&c--}else h==K.None&&e.armorPerks[P.ArmorSlotClass].fixed&&(h=e.armorPerks[P.ArmorSlotClass].value);return{valid:c<=0,requiredClassItemType:h}}addEventListener("message",function(){var e=ot(function*({data:t}){const n=Date.now();console.debug("START RESULTS BUILDER 2"),console.time("total");const r=t.config;console.log("Using config",t.config);let s=yield Promise.all(r.selectedExotics.filter(v=>-1!=v).map(function(){var v=ot(function*(V){return yield Gs.where("hash").equals(V).first()});return function(V){return v.apply(this,arguments)}}()));s=s.filter(v=>!!v);let i=yield Us.where("clazz").equals(r.characterClass).distinct().toArray();i=i.filter(v=>v.slot!=P.ArmorSlotNone).filter(v=>-1==r.disabledItems.indexOf(v.itemInstanceId)).filter(v=>-1==r.selectedExotics.indexOf(-1)||!v.isExotic).filter(v=>1!=s.length||s[0].slot!=v.slot||s[0].hash==v.hash).filter(v=>!r.onlyUseMasterworkedItems||v.masterworked).filter(v=>r.allowBlueArmorPieces||6==v.rarity||5==v.rarity).filter(v=>!r.ignoreSunsetArmor||!v.isSunset).filter(v=>!r.armorAffinities[v.slot].fixed||0==r.armorAffinities[v.slot].value||v.masterworked&&r.ignoreArmorAffinitiesOnMasterworkedItems||!v.masterworked&&r.ignoreArmorAffinitiesOnNonMasterworkedItems||r.armorAffinities[v.slot].value==v.energyAffinity).filter(v=>v.isExotic||!r.armorPerks[v.slot].fixed||r.armorPerks[v.slot].value==K.None||r.armorPerks[v.slot].value==v.perk);let o=i.filter(v=>v.slot==P.ArmorSlotHelmet).map(v=>new Te([v])),a=i.filter(v=>v.slot==P.ArmorSlotGauntlet).map(v=>new Te([v])),l=i.filter(v=>v.slot==P.ArmorSlotChest).map(v=>new Te([v])),c=i.filter(v=>v.slot==P.ArmorSlotLegs).map(v=>new Te([v]));const h=t.threadSplit;if(h.count>1){var u=[[o,o.length],[a,a.length],[l,l.length],[c,c.length]].sort((v,V)=>v[1]-V[1])[0][0],f=Math.floor(u.length/h.count),d=f*h.current,E=f*(h.current+1);f*h.count!=u.length&&h.current==h.count-1&&(E+=u.length-f*h.count),u.splice(E),u.splice(0,d)}let m=i.filter(v=>v.slot==P.ArmorSlotClass),S=new Set(m.map(v=>v.perk)),y=Array.from(S).reduce((v,V)=>{v.has(V)||v.set(V,new Set),v.has(K.None)||v.set(K.None,new Set);for(let q of m.filter(F=>F.perk==V))v.get(K.None)?.add(q.energyAffinity),v.get(V)?.add(q.energyAffinity);return v},new Map);if(s.length>1){let v=[...new Set(s.map(F=>F.slot))],V=i.filter(F=>F.hash==s[0].hash),q=i.filter(F=>F.hash==s[1].hash);if(1==v.length){let F=[];for(let W of V)for(let J of q)F.push(new Te([W,J]));switch(v[0]){case P.ArmorSlotHelmet:o=F,a=a.filter(W=>!W.containsExotics),l=l.filter(W=>!W.containsExotics),c=c.filter(W=>!W.containsExotics);break;case P.ArmorSlotGauntlet:a=F,o=o.filter(W=>!W.containsExotics),l=l.filter(W=>!W.containsExotics),c=c.filter(W=>!W.containsExotics);break;case P.ArmorSlotChest:l=F,o=o.filter(W=>!W.containsExotics),a=a.filter(W=>!W.containsExotics),c=c.filter(W=>!W.containsExotics);break;case P.ArmorSlotLegs:c=F,o=o.filter(W=>!W.containsExotics),a=a.filter(W=>!W.containsExotics),l=l.filter(W=>!W.containsExotics)}}else if(2==v.length){let F=i.filter(Y=>Y.slot==s[0].slot&&!Y.isExotic),W=i.filter(Y=>Y.slot==s[1].slot&&!Y.isExotic),J=[],ne=[];for(let Y of V)for(let Ve of W)J.push(new Te([Y,Ve]));for(let Y of q)for(let Ve of F)ne.push(new Te([Y,Ve]));o=o.filter(Y=>!Y.containsExotics),a=a.filter(Y=>!Y.containsExotics),l=l.filter(Y=>!Y.containsExotics),c=c.filter(Y=>!Y.containsExotics),v[0]===P.ArmorSlotHelmet?o=J:v[0]===P.ArmorSlotGauntlet?a=J:v[0]===P.ArmorSlotChest?l=J:v[0]===P.ArmorSlotLegs&&(c=J),v[1]===P.ArmorSlotHelmet?o=ne:v[1]===P.ArmorSlotGauntlet?a=ne:v[1]===P.ArmorSlotChest?l=ne:v[1]===P.ArmorSlotLegs&&(c=ne)}}console.debug("items",{helmets:o,gauntlets:a,chests:l,legs:c,availableClassItemTypes:S,availableClassItemEnergyPerkDict:y});const k={maximumPossibleTiers:[0,0,0,0,0,0],statCombo3x100:new Set,statCombo4x100:new Set},x=function $s(e){const t=[0,0,0,0,0,0];for(const r of e.enabledMods)for(const s of Hs[r].bonus)t[s.stat==Re.ClassAbilityRegenerationStat?[1,0,2][e.characterClass]:s.stat]+=s.value;return t}(r),w=function Js(e){let t=[0,0,0,0,0,0,0];return t[e.armorAffinities[P.ArmorSlotHelmet].value]++,t[e.armorAffinities[P.ArmorSlotChest].value]++,t[e.armorAffinities[P.ArmorSlotGauntlet].value]++,t[e.armorAffinities[P.ArmorSlotLegs].value]++,e.armorAffinities[P.ArmorSlotClass].fixed||t[e.armorAffinities[P.ArmorSlotClass].value]++,t[0]=0,t}(r),I=function Xs(e){let t=[];for(let n=0;n<K.COUNT;n++)t.push(0);return t[e.armorPerks[P.ArmorSlotHelmet].value]++,t[e.armorPerks[P.ArmorSlotChest].value]++,t[e.armorPerks[P.ArmorSlotGauntlet].value]++,t[e.armorPerks[P.ArmorSlotLegs].value]++,t[e.armorPerks[P.ArmorSlotClass].value]++,t}(r),O=function Qs(e){var t=[];return t.push(e.maximumModSlots[P.ArmorSlotHelmet].value),t.push(e.maximumModSlots[P.ArmorSlotGauntlet].value),t.push(e.maximumModSlots[P.ArmorSlotChest].value),t.push(e.maximumModSlots[P.ArmorSlotLegs].value),t.push(e.maximumModSlots[P.ArmorSlotClass].value),t.where(n=>n>0).sort()}(r),D=w[0]<5,b=s.length<=1;let p=[],C=0,R=0,L=0,A=!1;console.time("tm");for(let v of o)for(let V of a)if(!(b&&v.containsExotics&&V.containsExotics))for(let q of l)if(!b||!v.containsExotics&&!V.containsExotics||!q.containsExotics)for(let F of c){if(b&&(v.containsExotics||V.containsExotics||q.containsExotics)&&F.containsExotics)continue;const W=zs(r,I,S,v,V,q,F);if(!W.valid)continue;var j=0;if(D){const ne=Ys(r,w,y.get(W.requiredClassItemType??K.None)??new Set,v,V,q,F);if(!ne.valid)continue;j=ne.requiredClassItemElement}const J=ti(k,r,v,V,q,F,x,O.slice(),A);null!=J&&(L++,"DONOTSEND"!==J&&(J.classItem={perk:W.requiredClassItemType??K.None,affinity:j},p.push(J),C++,R++,A=A||r.limitParsedResults&&R>=5e4/h.count||R>=1e6/h.count)),C>=5e3&&(postMessage({runtime:k,results:p,done:!1,total:0}),p=[],C=0)}console.timeEnd("tm"),console.timeEnd("total"),postMessage({runtime:k,results:p,done:!0,stats:{permutationCount:L,itemCount:i.length-m.length,totalTime:Date.now()-n}})});return function(t){return e.apply(this,arguments)}}());class ei{constructor(t){this.list=[],this.comparatorList=[],this.length=0,this.comparator=t}insert(t){let r,n=this.comparator(t);for(r=0;r<this.list.length&&this.comparatorList[r]>n;r++);this.length++,this.list.splice(r,0,t),this.comparatorList.splice(r,0,n)}remove(t){let n=-1;for(let r=0;r<this.list.length;r++)if(this.list[r]==t){n=r;break}-1!=n&&(this.list.splice(n,1),this.comparatorList.splice(n,1),this.length--)}}function ti(e,t,n,r,s,i,o,a,l=!1){const c=[n,r,s,i];var h=t.assumeClassItemMasterworked?2:0;for(let b=0;b<c.length;b++){let p=c[b];(p.allMasterworked||p.containsExotics&&!p.containsLegendaries&&t.assumeExoticsMasterworked||!p.containsExotics&&p.containsLegendaries&&t.assumeLegendariesMasterworked||p.containsExotics&&p.containsLegendaries&&t.assumeLegendariesMasterworked&&t.assumeExoticsMasterworked)&&(h+=2)}const u=function Zs(e){let t=0;for(let n=0;n<e.length;n++)t+=e[n].items.length>1?1:0;if(t<=1)return[e[0].mobility.min+e[1].mobility.min+e[2].mobility.min+e[3].mobility.min,e[0].resilience.min+e[1].resilience.min+e[2].resilience.min+e[3].resilience.min,e[0].recovery.min+e[1].recovery.min+e[2].recovery.min+e[3].recovery.min,e[0].discipline.min+e[1].discipline.min+e[2].discipline.min+e[3].discipline.min,e[0].intellect.min+e[1].intellect.min+e[2].intellect.min+e[3].intellect.min,e[0].strength.min+e[1].strength.min+e[2].strength.min+e[3].strength.min];{let n=e.filter(s=>1==s.items.length),r=e.filter(s=>s.items.length>1).reduce((s,i)=>(s[0]=i.mobility.sum<s[0]?i.mobility.sum:s[0],s[1]=i.resilience.sum<s[1]?i.resilience.sum:s[1],s[2]=i.recovery.sum<s[2]?i.recovery.sum:s[2],s[3]=i.discipline.sum<s[3]?i.discipline.sum:s[3],s[4]=i.intellect.sum<s[4]?i.intellect.sum:s[4],s[5]=i.strength.sum<s[5]?i.strength.sum:s[5],s),[200,200,200,200,200,200]);for(let s of n)r[0]+=s.mobility.min,r[1]+=s.resilience.min,r[2]+=s.recovery.min,r[3]+=s.discipline.min,r[4]+=s.intellect.min,r[5]+=s.strength.min;return r}}(c);u[0]+=h,u[1]+=h+(!c[2].containsExotics&&t.addConstent1Resilience?1:0),u[2]+=h,u[3]+=h,u[4]+=h,u[5]+=h;const f=[u[0],u[1],u[2],u[3],u[4],u[5]];u[0]+=o[0],u[1]+=o[1],u[2]+=o[2],u[3]+=o[3],u[4]+=o[4],u[5]+=o[5];for(let b=0;b<6;b++)if(t.minimumStatTiers[b].fixed&&u[b]/10>=t.minimumStatTiers[b].value+1)return null;const d=[Math.ceil(Math.max(0,t.minimumStatTiers[0].value-u[0]/10)),Math.ceil(Math.max(0,t.minimumStatTiers[1].value-u[1]/10)),Math.ceil(Math.max(0,t.minimumStatTiers[2].value-u[2]/10)),Math.ceil(Math.max(0,t.minimumStatTiers[3].value-u[3]/10)),Math.ceil(Math.max(0,t.minimumStatTiers[4].value-u[4]/10)),Math.ceil(Math.max(0,t.minimumStatTiers[5].value-u[5]/10))],E=d[0]+d[1]+d[2]+d[3]+d[4]+d[5],m=new ei(b=>oe[b][2]);if(E>5)return null;let S=a.length;if(E>S)return null;if(E>0){for(let b=0;b<6;b++){if(0==d[b])continue;const p=u[b]%10;p>0&&p%10>=5&&(m.insert(1+2*b),d[b]--,u[b]+=5);for(let C=0;C<d[b];C++)m.insert(2+2*b),u[b]+=10}for(let b=0;b<m.length&&m.length<=5;b++){const p=m.list[b],C=oe[p][2],R=a.where(L=>L>=C);if(0==R.length){if(p%2!=0)return null;{m.remove(p);let L=p-1;m.insert(L),m.insert(L),b--}}else a.splice(a.indexOf(R[0]),1),S--}}if(m.length>5)return null;if(t.onlyShowResultsWithNoWastedStats){if(u.where(C=>C>100).length>0||u.where(C=>C%5!=0).length>0)return null;let b=[u[g.Mobility],u[g.Resilience],u[g.Recovery],u[g.Discipline],u[g.Intellect],u[g.Strength]].map((C,R)=>[C%10,R,C]).sort((C,R)=>R[0]-C[0]);for(let C=S-1;C>=0;C--){let R=b.where(A=>a.filter(j=>j>=oe[1+2*A[1]][2]).length>0).where(A=>A[0]>=5&&A[2]<100).sort((A,j)=>A[0]-j[0])[0];if(!R)break;const L=a.where(A=>A>=oe[1+2*R[1]][2])[0];a.splice(a.indexOf(L),1),S--,u[R[1]]+=5,R[0]-=5,m.insert(1+2*R[1])}if(hr(u)>0)return null}if(m.length>5)return null;const y=10*S,k=100-10*S,x=[];for(let b=0;b<6;b++){let p=u[b];if(p>=k&&x.push([b,100-p]),p+y>=e.maximumPossibleTiers[b]){let C=oe[1+2*b][2],R=oe[2+2*b][2];for(let L=0;L<S&&p<100;L++)a[L]>=R&&(p+=10),a[L]>=C&&a[L]<R&&(p+=5);p>e.maximumPossibleTiers[b]&&(e.maximumPossibleTiers[b]=p)}}if(S>0&&x.length>=3){x.sort((p,C)=>p[1]-C[1]);const b=[];for(let p=0;p<x.length-2;p++){let C=~~((Math.max(0,x[p][1],0)+9)/10);if(C>S)break;for(let R=p+1;R<x.length-1;R++){let L=~~((Math.max(0,x[R][1],0)+9)/10);if(C+L>S)break;for(let A=R+1;A<x.length;A++){let j=~~((Math.max(0,x[A][1],0)+9)/10);if(C+L+j>S)break;var w=!1;for(let v=A+1;v<x.length&&!(C+L+j+~~((Math.max(0,x[v][1],0)+9)/10)>S);v++)b.push([x[p],x[R],x[A],x[v]]),w=!0;w||b.push([x[p],x[R],x[A]])}}}for(let p of b){var I=[0,0,0,0,0,0];let C=0;for(let A=0;A<p.length;A++){if(p[A][1]<=0)continue;const j=p[A],v=j[0];let V=oe[1+2*v][2],q=oe[2+2*v][2];const F=Math.max(0,j[1]);let W=~~(F/10),J=F%10;J>5?W++:J>0&&(I[V]++,C++);for(let ne=0;ne<W;ne++)I[q]++,C++}const R=[0,0,0,1,2,2],L=[!1,!1,!1,!1,!1];if(!(C>S)){for(let A=5;A>=3;A--){let j=I[A];if(0==j)continue;let v=a.map((q,F)=>[q,F]).filter(([q,F])=>!L[F]&&q>=A),V=j;for(let q=0;q<V&&q<v.length;q++)L[v[q][1]]=!0,j--;for(let q=0;q<j;q++)I[A]--,I[R[A]]+=2,C++;if(C>S)break}C<=S&&(e.statCombo3x100.add((1<<p[0][0])+(1<<p[1][0])+(1<<p[2][0])),p.length>3&&e.statCombo4x100.add((1<<p[0][0])+(1<<p[1][0])+(1<<p[2][0])+(1<<p[3][0])))}}}if(l)return"DONOTSEND";if(t.tryLimitWastedStats&&S>0){let b=[u[g.Mobility],u[g.Resilience],u[g.Recovery],u[g.Discipline],u[g.Intellect],u[g.Strength]].map((p,C)=>[p%10,C,p]).sort((p,C)=>C[0]-p[0]);for(let p=0;p<S;p++){let C=b.where(L=>a.where(A=>A>=oe[1+2*L[1]][2]).length>0).filter(L=>L[0]>=5&&L[2]<100).sort((L,A)=>L[0]-A[0])[0];if(!C)break;if(t.minimumStatTiers[C[1]].fixed&&(u[C[1]]+5)/10>=t.minimumStatTiers[C[1]].value+1){C[0]-=5;continue}const R=a.where(L=>L>=oe[1+2*C[1]][2])[0];a.splice(a.indexOf(R),1),S--,u[C[1]]+=5,C[0]-=5,m.insert(1+2*C[1])}}const O=hr(u);if(t.onlyShowResultsWithNoWastedStats&&O>0)return null;const D=n.containsExotics?n:r.containsExotics?r:s.containsExotics?s:i.containsExotics?i:null;return{exotic:null==D?[]:[{icon:D?.items[0].icon,watermark:D?.items[0].watermarkIcon,name:D?.items[0].name,hash:D?.items[0].hash}],modCount:m.length,modCost:m.list.reduce((b,p)=>b+oe[p][2],0),mods:m.list,stats:u,statsNoMods:f,tiers:ni(u),waste:O,items:c.map(b=>b.items).flat().reduce((b,p)=>(b[p.slot-1].push({energy:p.energyAffinity,energyLevel:p.energyLevel,hash:p.hash,itemInstanceId:p.itemInstanceId,name:p.name,exotic:!!p.isExotic,masterworked:p.masterworked,mayBeBugged:p.mayBeBugged,slot:p.slot,perk:p.perk,transferState:0,stats:[p.mobility,p.resilience,p.recovery,p.discipline,p.intellect,p.strength]}),b),[[],[],[],[]])}}function ni(e){return Math.floor(Math.min(100,e[g.Mobility])/10)+Math.floor(Math.min(100,e[g.Resilience])/10)+Math.floor(Math.min(100,e[g.Recovery])/10)+Math.floor(Math.min(100,e[g.Discipline])/10)+Math.floor(Math.min(100,e[g.Intellect])/10)+Math.floor(Math.min(100,e[g.Strength])/10)}function hr(e){return(e[g.Mobility]>100?e[g.Mobility]-100:e[g.Mobility]%10)+(e[g.Resilience]>100?e[g.Resilience]-100:e[g.Resilience]%10)+(e[g.Recovery]>100?e[g.Recovery]-100:e[g.Recovery]%10)+(e[g.Discipline]>100?e[g.Discipline]-100:e[g.Discipline]%10)+(e[g.Intellect]>100?e[g.Intellect]-100:e[g.Intellect]%10)+(e[g.Strength]>100?e[g.Strength]-100:e[g.Strength]%10)}})();