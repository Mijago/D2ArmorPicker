<!--
  ~ Copyright (c) 2023 D2ArmorPicker by Mijago.
  ~
  ~ This program is free software: you can redistribute it and/or modify
  ~ it under the terms of the GNU Affero General Public License as published
  ~ by the Free Software Foundation, either version 3 of the License, or
  ~ (at your option) any later version.
  ~
  ~ This program is distributed in the hope that it will be useful,
  ~ but WITHOUT ANY WARRANTY; without even the implied warranty of
  ~ MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  ~ GNU Affero General Public License for more details.
  ~
  ~ You should have received a copy of the GNU Affero General Public License
  ~ along with this program.  If not, see <http://www.gnu.org/licenses/>.
  -->

<div>
  <mat-toolbar *ngIf="mayAnyItemBeBugged" class="invalid-item-box mat-elevation-z4" color="warn">
    Warning: The stats of one or more items used for this build may be invalid.<br />
    Please remove all negative/positive stat modifiers from the marked items.
  </mat-toolbar>

  This table shows you the expected stats of any item:
  <table class="specificStatTable">
    <thead>
      <tr>
        <th>Name</th>
        <th>{{ ArmorStatNames[ArmorStat.StatWeapon] }}</th>
        <th>{{ ArmorStatNames[ArmorStat.StatHealth] }}</th>
        <th>{{ ArmorStatNames[ArmorStat.StatClass] }}</th>
        <th>{{ ArmorStatNames[ArmorStat.StatGrenade] }}</th>
        <th>{{ ArmorStatNames[ArmorStat.StatSuper] }}</th>
        <th>{{ ArmorStatNames[ArmorStat.StatMelee] }}</th>
        <th></th>
        <th></th>
      </tr>
    </thead>
    <!-- Items -->
    <ng-container *ngFor="let i of ArmorItems">
      <tr>
        <td>
          <u
            #tooltip="matTooltip"
            *ngIf="i.masterworked"
            class="item-name-mw"
            matTooltip="This item is already masterworked."
            >{{ i.name }}</u
          >
          <span *ngIf="!i.masterworked">{{ i.name }}</span>
        </td>
        <ng-container
          *ngVar="
            i.masterworked ||
            (!i.exotic && config_assumeLegendariesMasterworked) ||
            (i.exotic && config_assumeExoticsMasterworked)
              ? 2
              : 0 as bonus
          ">
          <td class="item-stat-container">
            <span [class.text-mw]="i.masterworked" class="item-stat-value">{{
              i.stats[ArmorStat.StatWeapon] + bonus
            }}</span>
          </td>
          <td class="item-stat-container">
            <span [class.text-mw]="i.masterworked" class="item-stat-value">{{
              i.stats[ArmorStat.StatHealth] + bonus
            }}</span>
          </td>
          <td class="item-stat-container">
            <span [class.text-mw]="i.masterworked" class="item-stat-value">{{
              i.stats[ArmorStat.StatClass] + bonus
            }}</span>
          </td>
          <td class="item-stat-container">
            <span [class.text-mw]="i.masterworked" class="item-stat-value">{{
              i.stats[ArmorStat.StatGrenade] + bonus
            }}</span>
          </td>
          <td class="item-stat-container">
            <span [class.text-mw]="i.masterworked" class="item-stat-value">{{
              i.stats[ArmorStat.StatSuper] + bonus
            }}</span>
          </td>
          <td class="item-stat-container">
            <span [class.text-mw]="i.masterworked" class="item-stat-value">{{
              i.stats[ArmorStat.StatMelee] + bonus
            }}</span>
          </td>
        </ng-container>
        <td class="icon-column">
          <!-- Item Icon -->
          <div [itemTooltip]="i" class="item-icon-container">
            <app-item-icon
              [itemHash]="i.hash"
              [masterworked]="i.masterworked"
              [source]="i.source"
              class="item-icon">
            </app-item-icon>
          </div>
        </td>
        <td class="icon-column">
          <div style="position: relative; width: 25px">
            <app-armor-perk-icon [perk]="i.perk || 0"></app-armor-perk-icon>
          </div>
        </td>
        <!-- Disable -->
        <td class="icon-column">
          <button
            (click)="disableItem(i.itemInstanceId)"
            style="padding: 0; top: 0; left: 0"
            class="item-info-menu-btn"
            mat-icon-button
            matTooltip="Disable this item from the results. It will not be used to generate results anymore, but you can always undo this.">
            <mat-icon>block</mat-icon>
          </button>
        </td>
        <!-- Moving to inventory -->
        <td *ngIf="i.transferState === 1 || i.transferState === 2" class="icon-column">
          <mat-progress-spinner
            class="item-loading-spinner"
            color="primary"
            diameter="22"
            mode="indeterminate">
          </mat-progress-spinner>
        </td>
        <td *ngIf="i.transferState === 3">
          <mat-icon
            #tooltip="matTooltip"
            aria-hidden="false"
            aria-label="Success"
            class="item-moved-icon"
            inline
            matTooltip="Item successfully moved to inventory.">
            check_circle_outline
          </mat-icon>
        </td>
        <td *ngIf="i.transferState === 4">
          <mat-icon
            #tooltip="matTooltip"
            aria-hidden="false"
            aria-label="Error"
            class="report-problem-icon"
            inline
            matTooltip="This item could not be moved. Make sure that there is enough space on your character. This tool will not move items out of your inventory.">
            error_outline
          </mat-icon>
        </td>
        <!-- // Moving to inventory -->
        <td *ngIf="i.mayBeBugged">
          <mat-icon
            #tooltip="matTooltip"
            aria-hidden="false"
            aria-label="Error"
            class="report-problem-icon"
            inline
            matTooltip="The stats of this item may be incorrect. Make sure that you remove every positive or negative stat modifier from this item.">
            report_problem
          </mat-icon>
        </td>
      </tr>
    </ng-container>
    <!--Sum line without mods-->
    <tr *ngVar="element?.statsNoMods as stats" class="result-total-gear result-total highlight-row">
      <td>Total (armor)</td>
      <td *ngIf="!!stats">
        {{ stats[ArmorStat.StatWeapon] }}
        <img
          alt="Weapon"
          class="statIcon"
          src="https://www.bungie.net/common/destiny2_content/icons/e26e0e93a9daf4fdd21bf64eb9246340.png" />
      </td>
      <td *ngIf="!!stats">
        {{ stats[ArmorStat.StatHealth] }}
        <img
          alt="Health"
          class="statIcon"
          src="https://www.bungie.net/common/destiny2_content/icons/202ecc1c6febeb6b97dafc856e863140.png" />
      </td>
      <td *ngIf="!!stats">
        {{ stats[ArmorStat.StatClass] }}
        <img
          alt="Class"
          class="statIcon"
          src="https://www.bungie.net/common/destiny2_content/icons/128eee4ee7fc127851ab32eac6ca91cf.png" />
      </td>
      <td *ngIf="!!stats">
        {{ stats[ArmorStat.StatGrenade] }}
        <img
          alt="Grenade"
          class="statIcon"
          src="https://www.bungie.net/common/destiny2_content/icons/79be2d4adef6a19203f7385e5c63b45b.png" />
      </td>
      <td *ngIf="!!stats">
        {{ stats[ArmorStat.StatSuper] }}
        <img
          alt="Super"
          class="statIcon"
          src="https://www.bungie.net/common/destiny2_content/icons/d1c154469670e9a592c9d4cbdcae5764.png" />
      </td>
      <td *ngIf="!!stats">
        {{ stats[ArmorStat.StatMelee] }}
        <img
          alt="Melee"
          class="statIcon"
          src="https://www.bungie.net/common/destiny2_content/icons/ea5af04ccd6a3470a44fd7bb0f66e2f7.png" />
      </td>
    </tr>
    <!-- Config Mods -->
    <tr class="result-config">
      <td>Configuration</td>
      <td
        ><span
          *ngIf="this.configValues[ArmorStat.StatWeapon] !== 0"
          [class]="this.configValues[ArmorStat.StatWeapon] > 0 ? 'positive' : 'negative'">
          <span *ngIf="this.configValues[ArmorStat.StatWeapon] > 0">+</span
          >{{ this.configValues[ArmorStat.StatWeapon] }}
        </span></td
      >
      <td
        ><span
          *ngIf="this.configValues[ArmorStat.StatHealth] !== 0"
          [class]="this.configValues[ArmorStat.StatHealth] > 0 ? 'positive' : 'negative'">
          <span *ngIf="this.configValues[ArmorStat.StatHealth] > 0">+</span
          >{{ this.configValues[ArmorStat.StatHealth] }}
        </span></td
      >
      <td
        ><span
          *ngIf="this.configValues[ArmorStat.StatClass] !== 0"
          [class]="this.configValues[ArmorStat.StatClass] > 0 ? 'positive' : 'negative'">
          <span *ngIf="this.configValues[ArmorStat.StatClass] > 0">+</span
          >{{ this.configValues[ArmorStat.StatClass] }}
        </span></td
      >
      <td
        ><span
          *ngIf="this.configValues[ArmorStat.StatGrenade] !== 0"
          [class]="this.configValues[ArmorStat.StatGrenade] > 0 ? 'positive' : 'negative'">
          <span *ngIf="this.configValues[ArmorStat.StatGrenade] > 0">+</span
          >{{ this.configValues[ArmorStat.StatGrenade] }}
        </span></td
      >
      <td
        ><span
          *ngIf="this.configValues[ArmorStat.StatSuper] !== 0"
          [class]="this.configValues[ArmorStat.StatSuper] > 0 ? 'positive' : 'negative'">
          <span *ngIf="this.configValues[ArmorStat.StatSuper] > 0">+</span
          >{{ this.configValues[ArmorStat.StatSuper] }}
        </span></td
      >
      <td
        ><span
          *ngIf="this.configValues[ArmorStat.StatMelee] !== 0"
          [class]="this.configValues[ArmorStat.StatMelee] > 0 ? 'positive' : 'negative'">
          <span *ngIf="this.configValues[ArmorStat.StatMelee] > 0">+</span
          >{{ this.configValues[ArmorStat.StatMelee] }}
        </span></td
      >
    </tr>
    <!-- +5 Mods -->
    <tr *ngVar="element?.mods as mods" class="highlight-row">
      <td>Minor Mods</td>
      <td *ngVar="mods | count: StatModifier.MINOR_WEAPON as count">
        <span *ngIf="count > 0" class="positive">{{ count }}×5</span>
      </td>
      <td *ngVar="mods | count: StatModifier.MINOR_HEALTH as count">
        <span *ngIf="count > 0" class="positive">{{ count }}×5</span>
      </td>
      <td *ngVar="mods | count: StatModifier.MINOR_CLASS as count">
        <span *ngIf="count > 0" class="positive">{{ count }}×5</span>
      </td>
      <td *ngVar="mods | count: StatModifier.MINOR_GRENADE as count">
        <span *ngIf="count > 0" class="positive">{{ count }}×5</span>
      </td>
      <td *ngVar="mods | count: StatModifier.MINOR_SUPER as count">
        <span *ngIf="count > 0" class="positive">{{ count }}×5</span>
      </td>
      <td *ngVar="mods | count: StatModifier.MINOR_MELEE as count">
        <span *ngIf="count > 0" class="positive">{{ count }}×5</span>
      </td>
    </tr>
    <!-- +10 Mods -->
    <tr *ngVar="element?.mods as mods">
      <td>Major Mods</td>
      <td *ngVar="mods | count: StatModifier.MAJOR_WEAPON as count">
        <span *ngIf="count > 0" class="positive">{{ count }}×10</span>
      </td>
      <td *ngVar="mods | count: StatModifier.MAJOR_HEALTH as count">
        <span *ngIf="count > 0" class="positive">{{ count }}×10</span>
      </td>
      <td *ngVar="mods | count: StatModifier.MAJOR_CLASS as count">
        <span *ngIf="count > 0" class="positive">{{ count }}×10</span>
      </td>
      <td *ngVar="mods | count: StatModifier.MAJOR_GRENADE as count">
        <span *ngIf="count > 0" class="positive">{{ count }}×10</span>
      </td>
      <td *ngVar="mods | count: StatModifier.MAJOR_SUPER as count">
        <span *ngIf="count > 0" class="positive">{{ count }}×10</span>
      </td>
      <td *ngVar="mods | count: StatModifier.MAJOR_MELEE as count">
        <span *ngIf="count > 0" class="positive">{{ count }}×10</span>
      </td>
    </tr>
    <ng-container *ngVar="element?.artifice as mods">
      <tr>
        <td>Artifice Mods</td>
        <td *ngVar="mods | count: StatModifier.ARTIFICE_WEAPON as count">
          <span *ngIf="count > 0" class="positive">{{ count }}×3</span>
        </td>
        <td *ngVar="mods | count: StatModifier.ARTIFICE_HEALTH as count">
          <span *ngIf="count > 0" class="positive">{{ count }}×3</span>
        </td>
        <td *ngVar="mods | count: StatModifier.ARTIFICE_CLASS as count">
          <span *ngIf="count > 0" class="positive">{{ count }}×3</span>
        </td>
        <td *ngVar="mods | count: StatModifier.ARTIFICE_GRENADE as count">
          <span *ngIf="count > 0" class="positive">{{ count }}×3</span>
        </td>
        <td *ngVar="mods | count: StatModifier.ARTIFICE_SUPER as count">
          <span *ngIf="count > 0" class="positive">{{ count }}×3</span>
        </td>
        <td *ngVar="mods | count: StatModifier.ARTIFICE_MELEE as count">
          <span *ngIf="count > 0" class="positive">{{ count }}×3</span>
        </td>
      </tr>
    </ng-container>

    <!-- Final sum line -->
    <tr *ngVar="element?.stats as stats" class="result-total-all result-total highlight-row">
      <td>Total</td>
      <td>
        {{ stats[ArmorStat.StatWeapon] }}
        <img
          alt="Weapon"
          class="statIcon"
          src="https://www.bungie.net/common/destiny2_content/icons/e26e0e93a9daf4fdd21bf64eb9246340.png" />
      </td>
      <td>
        {{ stats[ArmorStat.StatHealth] }}
        <img
          alt="Health"
          class="statIcon"
          src="https://www.bungie.net/common/destiny2_content/icons/202ecc1c6febeb6b97dafc856e863140.png" />
      </td>
      <td>
        {{ stats[ArmorStat.StatClass] }}
        <img
          alt="Class"
          class="statIcon"
          src="https://www.bungie.net/common/destiny2_content/icons/128eee4ee7fc127851ab32eac6ca91cf.png" />
      </td>
      <td>
        {{ stats[ArmorStat.StatGrenade] }}
        <img
          alt="Grenade"
          class="statIcon"
          src="https://www.bungie.net/common/destiny2_content/icons/79be2d4adef6a19203f7385e5c63b45b.png" />
      </td>
      <td>
        {{ stats[ArmorStat.StatSuper] }}
        <img
          alt="Super"
          class="statIcon"
          src="https://www.bungie.net/common/destiny2_content/icons/d1c154469670e9a592c9d4cbdcae5764.png" />
      </td>
      <td>
        {{ stats[ArmorStat.StatMelee] }}
        <img
          alt="Melee"
          class="statIcon"
          src="https://www.bungie.net/common/destiny2_content/icons/ea5af04ccd6a3470a44fd7bb0f66e2f7.png" />
      </td>
    </tr>
  </table>
</div>
<ng-container *ngVar="calculateRequiredMasterworkCost() as cost">
  <div *ngIf="cost['total'] > 0" style="margin-top: 10px">
    Total material cost:
    <span *ngIf="cost['glimmer'] > 0" class="currency-icon-container" matTooltip="Glimmer">
      <img
        alt="Glimmer"
        class="currency-icon"
        src="https://www.bungie.net/common/destiny2_content/icons/88993eaeedad32f42072df6f77f47311.png" />
      {{ cost["glimmer"] | number }}
    </span>

    <span *ngIf="cost['core'] > 0" class="currency-icon-container" matTooltip="Enhancement Cores">
      <img
        alt="Enhancement Cores"
        class="currency-icon"
        src="https://www.bungie.net/common/destiny2_content/icons/0a4eb695ed55b4e720ddc401460cc0f9.jpg" />
      {{ cost["core"] }}
    </span>

    <span *ngIf="cost['prism'] > 0" class="currency-icon-container" matTooltip="Enhancement Prism">
      <img
        alt="Enhancement Prism"
        class="currency-icon"
        src="https://www.bungie.net/common/destiny2_content/icons/dea2a35badf7466d4c2c2697ce6e8d87.jpg" />
      {{ cost["prism"] }}
    </span>

    <span *ngIf="cost['ascshard'] > 0" class="currency-icon-container" matTooltip="Ascendant Shard">
      <img
        alt="Ascendant Shard"
        class="currency-icon"
        src="https://www.bungie.net/common/destiny2_content/icons/0271d214fc3ec91b3def799a4b286b46.jpg" />
      {{ cost["ascshard"] }}
    </span>
  </div>
</ng-container>

<div style="display: flex; align-items: center; flex-direction: column">
  <div class="buttonContainer">
    <button
      (click)="CopyDIMQuery()"
      color="primary"
      mat-raised-button
      matTooltip="Use this button to copy a DIM search query to your clip board. It allows you to search the given items in DIM.">
      Copy DIM query to clipboard
    </button>
    <button
      (click)="goToDIM()"
      color="primary"
      mat-raised-button
      matTooltip="Use this button to open this build as a DIM Loadout.">
      Open Loadout in DIM
    </button>
    <br />
    <small>The following two buttons may not work for some at the moment:</small><br />
    <button
      (click)="moveItems()"
      mat-stroked-button
      matTooltip="Click this button to move Items to your inventory. Make sure that you have enough space in your inventory. This tool will not move any items out of your inventory.">
      Move items to inventory (beta)
    </button>
    <button
      (click)="moveItems(true)"
      mat-stroked-button
      matTooltip="Click this button to equip the Items. Make sure that you have enough space in your inventory. This tool will not move any items out of your inventory.">
      Equip Items (beta)
    </button>
  </div>
</div>

<mat-accordion>
  <mat-expansion-panel class="mat-elevation-z6">
    <mat-expansion-panel-header>
      <mat-panel-title> What to do now? </mat-panel-title>
      <mat-panel-description>
        Detailed Instructions of to get your loadout ready.
      </mat-panel-description>
    </mat-expansion-panel-header>
    <div>
      <ol>
        <li>
          Move all related items into your inventory
          <span *ngIf="config_assumeClassItemMasterworked"> and use a masterworked class item</span
          >.
        </li>
        <!-- Masterwork and elements -->
        <ng-container *ngVar="getItemsThatMustBeMasterworked() as mwItems">
          <li *ngIf="mwItems.length > 0">
            Masterwork these items:
            <ul>
              <li *ngFor="let item1 of mwItems">
                {{ item1.name }}
              </li>
            </ul>
          </li>
        </ng-container>

        <!-- Mods -->
        <li
          *ngIf="
            $any(element?.mods).length > 0 && ($any(element?.mods) | count: StatModifier.NONE) < 5
          "
          >Equip the following stat mods:
          <ul *ngVar="element?.mods as mods">
            <!-- MOBILITY -->
            <ng-container *ngVar="mods | count: StatModifier.MINOR_WEAPON as minorCount">
              <ng-container *ngVar="mods | count: StatModifier.MAJOR_WEAPON as majorCount">
                <li *ngIf="minorCount + majorCount > 0" class="positive">
                  <span *ngIf="minorCount > 0">{{ minorCount }} minor</span>
                  <ng-container *ngIf="minorCount > 0 && majorCount > 0"> and</ng-container>
                  <span *ngIf="majorCount > 0"> {{ majorCount }} major </span>
                  Weapon Mod<ng-container *ngIf="minorCount + majorCount > 1">s</ng-container>
                </li>
              </ng-container>
            </ng-container>
            <!-- /MOBILITY -->
            <!-- RESILIENCE -->
            <ng-container *ngVar="mods | count: StatModifier.MINOR_HEALTH as minorCount">
              <ng-container *ngVar="mods | count: StatModifier.MAJOR_HEALTH as majorCount">
                <li *ngIf="minorCount + majorCount > 0" class="positive">
                  <span *ngIf="minorCount > 0">{{ minorCount }} minor</span>
                  <ng-container *ngIf="minorCount > 0 && majorCount > 0"> and</ng-container>
                  <span *ngIf="majorCount > 0"> {{ majorCount }} major </span>
                  Health Mod<ng-container *ngIf="minorCount + majorCount > 1">s</ng-container>
                </li>
              </ng-container>
            </ng-container>
            <!-- /RESILIENCE -->
            <!-- RECOVERY -->
            <ng-container *ngVar="mods | count: StatModifier.MINOR_CLASS as minorCount">
              <ng-container *ngVar="mods | count: StatModifier.MAJOR_CLASS as majorCount">
                <li *ngIf="minorCount + majorCount > 0" class="positive">
                  <span *ngIf="minorCount > 0">{{ minorCount }} minor</span>
                  <ng-container *ngIf="minorCount > 0 && majorCount > 0"> and</ng-container>
                  <span *ngIf="majorCount > 0"> {{ majorCount }} major </span>
                  Class Mod<ng-container *ngIf="minorCount + majorCount > 1">s</ng-container>
                </li>
              </ng-container>
            </ng-container>
            <!-- /RECOVERY -->
            <!-- DISCIPLINE -->
            <ng-container *ngVar="mods | count: StatModifier.MINOR_GRENADE as minorCount">
              <ng-container *ngVar="mods | count: StatModifier.MAJOR_GRENADE as majorCount">
                <li *ngIf="minorCount + majorCount > 0" class="positive">
                  <span *ngIf="minorCount > 0">{{ minorCount }} minor</span>
                  <ng-container *ngIf="minorCount > 0 && majorCount > 0"> and</ng-container>
                  <span *ngIf="majorCount > 0"> {{ majorCount }} major </span>
                  Grenade Mod<ng-container *ngIf="minorCount + majorCount > 1">s</ng-container>
                </li>
              </ng-container>
            </ng-container>
            <!-- /DISCIPLINE -->
            <!-- INTELLECT -->
            <ng-container *ngVar="mods | count: StatModifier.MINOR_SUPER as minorCount">
              <ng-container *ngVar="mods | count: StatModifier.MAJOR_SUPER as majorCount">
                <li *ngIf="minorCount + majorCount > 0" class="positive">
                  <span *ngIf="minorCount > 0">{{ minorCount }} minor</span>
                  <ng-container *ngIf="minorCount > 0 && majorCount > 0"> and</ng-container>
                  <span *ngIf="majorCount > 0"> {{ majorCount }} major </span>
                  Super Mod<ng-container *ngIf="minorCount + majorCount > 1">s</ng-container>
                </li>
              </ng-container>
            </ng-container>
            <!-- /INTELLECT -->
            <!-- STRENGTH -->
            <ng-container *ngVar="mods | count: StatModifier.MINOR_MELEE as minorCount">
              <ng-container *ngVar="mods | count: StatModifier.MAJOR_MELEE as majorCount">
                <li *ngIf="minorCount + majorCount > 0" class="positive">
                  <span *ngIf="minorCount > 0">{{ minorCount }} minor</span>
                  <ng-container *ngIf="minorCount > 0 && majorCount > 0"> and</ng-container>
                  <span *ngIf="majorCount > 0"> {{ majorCount }} major </span>
                  Melee Mod<ng-container *ngIf="minorCount + majorCount > 1">s</ng-container>
                </li>
              </ng-container>
            </ng-container>
            <!-- /STRENGTH -->
          </ul>
        </li>
        <li *ngIf="config_enabledMods.length > 0">
          Equip any mods and fragments that you enabled in the configuration:
          <ul>
            <ng-container *ngFor="let mod of config_enabledMods">
              <ng-container *ngVar="ModInformation[mod] as info">
                <li *ngIf="info.type === ModifierType.CombatStyleMod">
                  Equip the mod {{ info.name }}
                </li>
              </ng-container>
            </ng-container>
            <ng-container *ngFor="let mod of config_enabledMods">
              <ng-container *ngVar="ModInformation[mod] as info">
                <li *ngIf="info.type === ModifierType.Stasis">
                  Equip the stasis fragment {{ info.name }}
                </li>
              </ng-container>
            </ng-container>
          </ul>
        </li>
      </ol>
    </div>
  </mat-expansion-panel>
  <mat-expansion-panel class="mat-elevation-z6">
    <mat-expansion-panel-header>
      <mat-panel-title> Stat overview </mat-panel-title>
      <mat-panel-description>
        Shows a summary of all the stats and where they come from.
      </mat-panel-description>
    </mat-expansion-panel-header>
    <table class="stat-preview">
      <tr>
        <td colspan="2">Stat</td>
        <td class="tier-column">1</td>
        <td class="tier-column">2</td>
        <td class="tier-column">3</td>
        <td class="tier-column">4</td>
        <td class="tier-column">5</td>
        <td class="tier-column">6</td>
        <td class="tier-column">7</td>
        <td class="tier-column">8</td>
        <td class="tier-column">9</td>
        <td class="tier-column">10</td>
        <td>Tiers</td>
      </tr>
      <tr *ngFor="let statId of armorStatIds">
        <td>{{ ArmorStatNames[statId] }}</td>
        <td>
          <img
            alt="{{ ArmorStatNames[statId] }}"
            src="{{ ArmorStatIconUrls[statId] }}"
            style="height: 18px" />
        </td>
        <td *ngFor="let d of getColumnForStat(statId)">
          <div *ngIf="!!d" [class]="d" class="energy-bar"></div>
        </td>
        <td class="sum-tiers">{{ getTiersForStat(statId) }}</td>
      </tr>
      <tr class="legend">
        <td colspan="2">Armor</td>
        <td>
          <div class="energy-bar normal"></div>
        </td>
        <td colspan="3">Stat Mod</td>
        <td>
          <div class="energy-bar mod"></div>
        </td>
        <td colspan="4">Fragments & Mods</td>
        <td>
          <div class="energy-bar config"></div>
        </td>
      </tr>
      <ng-container *ngVar="element?.exotic as exotic">
        <tr *ngIf="exotic">
          <td>Exotic:</td>
          <td colspan="10">{{ exotic.name }}</td>
          <td colspan="1">
            <div class="item-icon-container">
              <img class="item-icon" src="https://bungie.net/{{ exotic.icon }}" />
              <img class="item-icon-overlay" src="https://bungie.net/{{ exotic.watermark }}" />
            </div>
          </td>
        </tr>
      </ng-container>
    </table>
  </mat-expansion-panel>
</mat-accordion>
<br />
<br />
